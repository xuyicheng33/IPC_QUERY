import{j as a,g as se,a as ie,r as p,u as ce,b as w,d as n,R as q,c as de,A as pe}from"./chunks/AppProviders.js";import{D as P,C as R}from"./chunks/Card.js";import{c as ue,u as be,B,a as A,b as z,f as ge,E as fe,d as me}from"./chunks/api.js";import{d as xe,e as G,m as ve,s as $e,a as Ce,p as ye,c as je}from"./chunks/urlState.js";import{E as Se,a as ke,d as he}from"./chunks/keyword.js";import{M as D}from"./chunks/MaterialSymbol.js";const Ne=ue(a.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"}));function Ie(e){return se("MuiChip",e)}const t=ie("MuiChip",["root","sizeSmall","sizeMedium","colorDefault","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","disabled","clickable","clickableColorPrimary","clickableColorSecondary","deletable","deletableColorPrimary","deletableColorSecondary","outlined","filled","outlinedPrimary","outlinedSecondary","filledPrimary","filledSecondary","avatar","avatarSmall","avatarMedium","avatarColorPrimary","avatarColorSecondary","icon","iconSmall","iconMedium","iconColorPrimary","iconColorSecondary","label","labelSmall","labelMedium","deleteIcon","deleteIconSmall","deleteIconMedium","deleteIconColorPrimary","deleteIconColorSecondary","deleteIconOutlinedColorPrimary","deleteIconOutlinedColorSecondary","deleteIconFilledColorPrimary","deleteIconFilledColorSecondary","focusVisible"]),we=e=>{const{classes:r,disabled:o,size:l,color:s,iconColor:f,onDelete:u,clickable:d,variant:b}=e,m={root:["root",b,o&&"disabled",`size${n(l)}`,`color${n(s)}`,d&&"clickable",d&&`clickableColor${n(s)}`,u&&"deletable",u&&`deletableColor${n(s)}`,`${b}${n(s)}`],label:["label",`label${n(l)}`],avatar:["avatar",`avatar${n(l)}`,`avatarColor${n(s)}`],icon:["icon",`icon${n(l)}`,`iconColor${n(f)}`],deleteIcon:["deleteIcon",`deleteIcon${n(l)}`,`deleteIconColor${n(s)}`,`deleteIcon${n(b)}Color${n(s)}`]};return xe(m,Ie,r)},Pe=G("div",{name:"MuiChip",slot:"Root",overridesResolver:(e,r)=>{const{ownerState:o}=e,{color:l,iconColor:s,clickable:f,onDelete:u,size:d,variant:b}=o;return[{[`& .${t.avatar}`]:r.avatar},{[`& .${t.avatar}`]:r[`avatar${n(d)}`]},{[`& .${t.avatar}`]:r[`avatarColor${n(l)}`]},{[`& .${t.icon}`]:r.icon},{[`& .${t.icon}`]:r[`icon${n(d)}`]},{[`& .${t.icon}`]:r[`iconColor${n(s)}`]},{[`& .${t.deleteIcon}`]:r.deleteIcon},{[`& .${t.deleteIcon}`]:r[`deleteIcon${n(d)}`]},{[`& .${t.deleteIcon}`]:r[`deleteIconColor${n(l)}`]},{[`& .${t.deleteIcon}`]:r[`deleteIcon${n(b)}Color${n(l)}`]},r.root,r[`size${n(d)}`],r[`color${n(l)}`],f&&r.clickable,f&&l!=="default"&&r[`clickableColor${n(l)}`],u&&r.deletable,u&&l!=="default"&&r[`deletableColor${n(l)}`],r[b],r[`${b}${n(l)}`]]}})(ve(({theme:e})=>{const r=e.palette.mode==="light"?e.palette.grey[700]:e.palette.grey[300];return{maxWidth:"100%",fontFamily:e.typography.fontFamily,fontSize:e.typography.pxToRem(13),display:"inline-flex",alignItems:"center",justifyContent:"center",height:32,lineHeight:1.5,color:(e.vars||e).palette.text.primary,backgroundColor:(e.vars||e).palette.action.selected,borderRadius:32/2,whiteSpace:"nowrap",transition:e.transitions.create(["background-color","box-shadow"]),cursor:"unset",outline:0,textDecoration:"none",border:0,padding:0,verticalAlign:"middle",boxSizing:"border-box",[`&.${t.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity,pointerEvents:"none"},[`& .${t.avatar}`]:{marginLeft:5,marginRight:-6,width:24,height:24,color:e.vars?e.vars.palette.Chip.defaultAvatarColor:r,fontSize:e.typography.pxToRem(12)},[`& .${t.avatarColorPrimary}`]:{color:(e.vars||e).palette.primary.contrastText,backgroundColor:(e.vars||e).palette.primary.dark},[`& .${t.avatarColorSecondary}`]:{color:(e.vars||e).palette.secondary.contrastText,backgroundColor:(e.vars||e).palette.secondary.dark},[`& .${t.avatarSmall}`]:{marginLeft:4,marginRight:-4,width:18,height:18,fontSize:e.typography.pxToRem(10)},[`& .${t.icon}`]:{marginLeft:5,marginRight:-6},[`& .${t.deleteIcon}`]:{WebkitTapHighlightColor:"transparent",color:e.alpha((e.vars||e).palette.text.primary,.26),fontSize:22,cursor:"pointer",margin:"0 5px 0 -6px","&:hover":{color:e.alpha((e.vars||e).palette.text.primary,.4)}},variants:[{props:{size:"small"},style:{height:24,[`& .${t.icon}`]:{fontSize:18,marginLeft:4,marginRight:-4},[`& .${t.deleteIcon}`]:{fontSize:16,marginRight:4,marginLeft:-4}}},...Object.entries(e.palette).filter(z(["contrastText"])).map(([o])=>({props:{color:o},style:{backgroundColor:(e.vars||e).palette[o].main,color:(e.vars||e).palette[o].contrastText,[`& .${t.deleteIcon}`]:{color:e.alpha((e.vars||e).palette[o].contrastText,.7),"&:hover, &:active":{color:(e.vars||e).palette[o].contrastText}}}})),{props:o=>o.iconColor===o.color,style:{[`& .${t.icon}`]:{color:e.vars?e.vars.palette.Chip.defaultIconColor:r}}},{props:o=>o.iconColor===o.color&&o.color!=="default",style:{[`& .${t.icon}`]:{color:"inherit"}}},{props:{onDelete:!0},style:{[`&.${t.focusVisible}`]:{backgroundColor:e.alpha((e.vars||e).palette.action.selected,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.focusOpacity}`)}}},...Object.entries(e.palette).filter(z(["dark"])).map(([o])=>({props:{color:o,onDelete:!0},style:{[`&.${t.focusVisible}`]:{background:(e.vars||e).palette[o].dark}}})),{props:{clickable:!0},style:{userSelect:"none",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:hover":{backgroundColor:e.alpha((e.vars||e).palette.action.selected,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.hoverOpacity}`)},[`&.${t.focusVisible}`]:{backgroundColor:e.alpha((e.vars||e).palette.action.selected,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.focusOpacity}`)},"&:active":{boxShadow:(e.vars||e).shadows[1]}}},...Object.entries(e.palette).filter(z(["dark"])).map(([o])=>({props:{color:o,clickable:!0},style:{[`&:hover, &.${t.focusVisible}`]:{backgroundColor:(e.vars||e).palette[o].dark}}})),{props:{variant:"outlined"},style:{backgroundColor:"transparent",border:e.vars?`1px solid ${e.vars.palette.Chip.defaultBorder}`:`1px solid ${e.palette.mode==="light"?e.palette.grey[400]:e.palette.grey[700]}`,[`&.${t.clickable}:hover`]:{backgroundColor:(e.vars||e).palette.action.hover},[`&.${t.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`& .${t.avatar}`]:{marginLeft:4},[`& .${t.avatarSmall}`]:{marginLeft:2},[`& .${t.icon}`]:{marginLeft:4},[`& .${t.iconSmall}`]:{marginLeft:2},[`& .${t.deleteIcon}`]:{marginRight:5},[`& .${t.deleteIconSmall}`]:{marginRight:3}}},...Object.entries(e.palette).filter(z()).map(([o])=>({props:{variant:"outlined",color:o},style:{color:(e.vars||e).palette[o].main,border:`1px solid ${e.alpha((e.vars||e).palette[o].main,.7)}`,[`&.${t.clickable}:hover`]:{backgroundColor:e.alpha((e.vars||e).palette[o].main,(e.vars||e).palette.action.hoverOpacity)},[`&.${t.focusVisible}`]:{backgroundColor:e.alpha((e.vars||e).palette[o].main,(e.vars||e).palette.action.focusOpacity)},[`& .${t.deleteIcon}`]:{color:e.alpha((e.vars||e).palette[o].main,.7),"&:hover, &:active":{color:(e.vars||e).palette[o].main}}}}))]}})),Re=G("span",{name:"MuiChip",slot:"Label",overridesResolver:(e,r)=>{const{ownerState:o}=e,{size:l}=o;return[r.label,r[`label${n(l)}`]]}})({overflow:"hidden",textOverflow:"ellipsis",paddingLeft:12,paddingRight:12,whiteSpace:"nowrap",variants:[{props:{variant:"outlined"},style:{paddingLeft:11,paddingRight:11}},{props:{size:"small"},style:{paddingLeft:8,paddingRight:8}},{props:{size:"small",variant:"outlined"},style:{paddingLeft:7,paddingRight:7}}]});function W(e){return e.key==="Backspace"||e.key==="Delete"}const ze=p.forwardRef(function(r,o){const l=ce({props:r,name:"MuiChip"}),{avatar:s,className:f,clickable:u,color:d="default",component:b,deleteIcon:m,disabled:i=!1,icon:$,label:k,onClick:x,onDelete:g,onKeyDown:h,onKeyUp:y,size:E="medium",variant:N="filled",tabIndex:L,skipFocusWhenDisabled:v=!1,slots:I={},slotProps:Q={},...X}=l,Y=p.useRef(null),Z=be(Y,o),O=c=>{c.stopPropagation(),g(c)},ee=c=>{c.currentTarget===c.target&&W(c)&&c.preventDefault(),h&&h(c)},ae=c=>{c.currentTarget===c.target&&g&&W(c)&&g(c),y&&y(c)},F=u!==!1&&x?!0:u,M=F||g?B:b||"div",_={...l,component:M,disabled:i,size:E,color:d,iconColor:p.isValidElement($)&&$.props.color||d,onDelete:!!g,clickable:F,variant:N},j=we(_),re=M===B?{component:b||"div",focusVisibleClassName:j.focusVisible,...g&&{disableRipple:!0}}:{};let U=null;g&&(U=m&&p.isValidElement(m)?p.cloneElement(m,{className:w(m.props.className,j.deleteIcon),onClick:O}):a.jsx(Ne,{className:j.deleteIcon,onClick:O}));let V=null;s&&p.isValidElement(s)&&(V=p.cloneElement(s,{className:w(j.avatar,s.props.className)}));let H=null;$&&p.isValidElement($)&&(H=p.cloneElement($,{className:w(j.icon,$.props.className)}));const K={slots:I,slotProps:Q},[oe,te]=A("root",{elementType:Pe,externalForwardedProps:{...K,...X},ownerState:_,shouldForwardComponentProp:!0,ref:Z,className:w(j.root,f),additionalProps:{disabled:F&&i?!0:void 0,tabIndex:v&&i?-1:L,...re},getSlotProps:c=>({...c,onClick:C=>{c.onClick?.(C),x?.(C)},onKeyDown:C=>{c.onKeyDown?.(C),ee(C)},onKeyUp:C=>{c.onKeyUp?.(C),ae(C)}})}),[le,ne]=A("label",{elementType:Re,externalForwardedProps:K,ownerState:_,className:j.label});return a.jsxs(oe,{as:M,...te,children:[V||H,a.jsx(le,{...ne,children:k}),U]})}),De={neutral:"bg-surface text-muted border-border",ok:"bg-accent-soft text-accent border-accent",bad:"bg-[#fff5f5] text-danger border-danger",warn:"bg-amber-50 text-amber-700 border-amber-300"};function J({variant:e="neutral",children:r,className:o}){return a.jsx(ze,{label:r,variant:"outlined",size:"small",className:`${De[e]} ${o||""}`})}function Ee(e){const{pathname:r,search:o}=e,l=r.match(/^\/part\/(\d+)\/?$/),s=l?Number(l[1]):NaN;if(Number.isFinite(s)&&s>0)return s;const f=new URLSearchParams(o||""),u=Number(f.get("id")||"");return Number.isFinite(u)&&u>0?u:null}function T({title:e,items:r,state:o}){const l=je(o).toString();return a.jsxs("div",{className:"rounded-md border border-border bg-surface p-4",children:[a.jsx("div",{className:"mb-2 text-sm font-medium",children:e}),r.length===0?a.jsx("p",{className:"text-sm text-muted",children:"无"}):a.jsx("div",{className:"grid gap-2",children:r.map(s=>a.jsx("a",{href:`/part.html?id=${encodeURIComponent(String(s.id))}${l?`&${l}`:""}`,className:"rounded-md border border-border bg-surface-soft px-3 py-2 font-mono text-xs transition-colors duration-fast ease-premium hover:bg-accent-soft",children:s.pn||s.part_number||"-"},s.id))})]})}function Le(){const e=Ee(window.location),[r,o]=p.useState(null),[l,s]=p.useState(!0),[f,u]=p.useState(""),d=p.useMemo(()=>$e(window.location.search),[]),b=p.useMemo(()=>Ce(d),[d]),m=p.useMemo(()=>ye(window.location.search,b),[b]);if(p.useEffect(()=>{if(!e){u("无效的零件 ID"),s(!1);return}(async()=>{try{const v=await ge(`/api/part/${e}`);o(v)}catch(v){u(String(v?.message||v))}finally{s(!1)}})()},[e]),l)return a.jsx(P,{backHref:m,children:a.jsx(R,{children:a.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted",children:[a.jsx(D,{name:"progress_activity",size:18,className:"animate-spin"}),"加载中..."]})})});if(f)return a.jsx(P,{backHref:m,children:a.jsx(Se,{message:`加载失败：${f}`,actionLabel:"重试",onAction:()=>window.location.reload()})});const i=r?.part;if(!i)return a.jsx(P,{backHref:m,children:a.jsx(fe,{title:"未找到零件信息"})});const $=String(i.pn||i.part_number_canonical||i.part_number_cell||"-"),k=String(i.source_relative_path||i.source_pdf||i.pdf||""),x=Number(i.page||i.page_num||1),g=Number(i.page_end||x),h=String(i.nom||i.nomenclature||i.nomenclature_clean||"").trim(),y=he(h),E=ke(h||"-"),N=encodeURIComponent(k),L=`/pdf/${N}#page=${x}`;return a.jsx(P,{backHref:m,children:a.jsxs("div",{className:"grid gap-4",children:[a.jsxs(R,{className:"grid gap-4",children:[a.jsx("div",{className:"flex flex-wrap items-center justify-end gap-2",children:a.jsxs(me,{component:"a",href:L,target:"_blank",rel:"noreferrer",variant:"primary",className:"gap-2",children:[a.jsx(D,{name:"description",size:18}),"打开 PDF"]})}),a.jsxs("div",{className:"border-b border-border pb-3",children:[a.jsx("div",{className:"font-mono text-[30px] font-semibold leading-tight",children:$}),a.jsxs("p",{className:"mt-1 text-sm text-muted",children:[k||"-"," · 页 ",x,g!==x?`~${g}`:""]})]}),a.jsxs("div",{className:"grid gap-3 md:grid-cols-2 xl:grid-cols-3",children:[a.jsx(S,{label:"来源",value:k||"-"}),a.jsx(S,{label:"页码",value:g!==x?`${x}~${g}`:String(x)}),a.jsx(S,{label:"图号",value:String(i.fig||i.figure_code||"-")}),a.jsx(S,{label:"项号",value:String(i.fig_item||"-")}),a.jsx(S,{label:"数量",value:String(i.units||i.units_per_assy||"-")}),a.jsx(S,{label:"适用号段",value:String(i.eff||i.effectivity||"-")})]}),a.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.jsxs(J,{variant:y.optional?"ok":"neutral",children:["optional: ",y.optional?"是":"否"]}),a.jsxs(J,{variant:y.replace?"ok":"neutral",children:["replace: ",y.replace?"是":"否"]})]}),a.jsxs("div",{className:"rounded-md border border-border bg-surface-soft p-4",children:[a.jsx("div",{className:"mb-2 text-sm font-medium",children:"术语"}),a.jsx("p",{className:"whitespace-pre-wrap break-words text-sm leading-6 text-text",children:E.map((v,I)=>v.hit?a.jsx("mark",{className:"rounded-sm bg-accent-soft px-1 text-text",children:v.text},I):a.jsx(q.Fragment,{children:v.text},I))})]})]}),a.jsxs(R,{children:[a.jsxs("div",{className:"mb-3 flex items-center gap-2 text-sm font-medium",children:[a.jsx(D,{name:"account_tree",size:18,sx:{color:"text.secondary"}}),"层级关系"]}),a.jsxs("div",{className:"grid gap-3 md:grid-cols-2 xl:grid-cols-3",children:[a.jsx(T,{title:"父辈",items:r?.parents||[],state:d}),a.jsx(T,{title:"平辈",items:r?.siblings||[],state:d}),a.jsx(T,{title:"子辈",items:r?.children||[],state:d})]})]}),a.jsxs(R,{children:[a.jsxs("div",{className:"mb-2 flex items-center gap-2 text-sm font-medium",children:[a.jsx(D,{name:"link",size:18,sx:{color:"text.secondary"}}),"整页预览"]}),a.jsx("div",{className:"overflow-hidden rounded-md border border-border",children:a.jsx("img",{src:`/render/${N}/${x}.png`,alt:"PDF page preview",className:"block w-full bg-surface"})})]})]})})}function S({label:e,value:r}){return a.jsxs("div",{className:"rounded-md border border-border bg-surface p-3",children:[a.jsx("div",{className:"text-[10px] uppercase tracking-wider text-muted",children:e}),a.jsx("div",{className:"mt-1 font-mono text-sm font-medium text-text",children:r})]})}de.createRoot(document.getElementById("root")).render(a.jsx(q.StrictMode,{children:a.jsx(pe,{children:a.jsx(Le,{})})}));
