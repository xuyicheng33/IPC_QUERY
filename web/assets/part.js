import{j as a,g as ie,a as ce,r as u,u as de,b as P,d as l,M as I,R as J,c as pe,A as ue}from"./chunks/AppProviders.js";import{s as ge,a as be,f as fe,A as R,E as xe,c as me}from"./chunks/urlState.js";import{c as ve,u as $e,a as H,b as B,d as Ce,s as q,m as ye,e as z,C as D,B as F}from"./chunks/Card.js";import{E as je,a as Se,d as ke}from"./chunks/keyword.js";const he=ve(a.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"}));function Ie(e){return ie("MuiChip",e)}const t=ce("MuiChip",["root","sizeSmall","sizeMedium","colorDefault","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","disabled","clickable","clickableColorPrimary","clickableColorSecondary","deletable","deletableColorPrimary","deletableColorSecondary","outlined","filled","outlinedPrimary","outlinedSecondary","filledPrimary","filledSecondary","avatar","avatarSmall","avatarMedium","avatarColorPrimary","avatarColorSecondary","icon","iconSmall","iconMedium","iconColorPrimary","iconColorSecondary","label","labelSmall","labelMedium","deleteIcon","deleteIconSmall","deleteIconMedium","deleteIconColorPrimary","deleteIconColorSecondary","deleteIconOutlinedColorPrimary","deleteIconOutlinedColorSecondary","deleteIconFilledColorPrimary","deleteIconFilledColorSecondary","focusVisible"]),Ne=e=>{const{classes:r,disabled:o,size:n,color:i,iconColor:v,onDelete:g,clickable:d,variant:p}=e,s={root:["root",p,o&&"disabled",`size${l(n)}`,`color${l(i)}`,d&&"clickable",d&&`clickableColor${l(i)}`,g&&"deletable",g&&`deletableColor${l(i)}`,`${p}${l(i)}`],label:["label",`label${l(n)}`],avatar:["avatar",`avatar${l(n)}`,`avatarColor${l(i)}`],icon:["icon",`icon${l(n)}`,`iconColor${l(v)}`],deleteIcon:["deleteIcon",`deleteIcon${l(n)}`,`deleteIconColor${l(i)}`,`deleteIcon${l(p)}Color${l(i)}`]};return Ce(s,Ie,r)},we=q("div",{name:"MuiChip",slot:"Root",overridesResolver:(e,r)=>{const{ownerState:o}=e,{color:n,iconColor:i,clickable:v,onDelete:g,size:d,variant:p}=o;return[{[`& .${t.avatar}`]:r.avatar},{[`& .${t.avatar}`]:r[`avatar${l(d)}`]},{[`& .${t.avatar}`]:r[`avatarColor${l(n)}`]},{[`& .${t.icon}`]:r.icon},{[`& .${t.icon}`]:r[`icon${l(d)}`]},{[`& .${t.icon}`]:r[`iconColor${l(i)}`]},{[`& .${t.deleteIcon}`]:r.deleteIcon},{[`& .${t.deleteIcon}`]:r[`deleteIcon${l(d)}`]},{[`& .${t.deleteIcon}`]:r[`deleteIconColor${l(n)}`]},{[`& .${t.deleteIcon}`]:r[`deleteIcon${l(p)}Color${l(n)}`]},r.root,r[`size${l(d)}`],r[`color${l(n)}`],v&&r.clickable,v&&n!=="default"&&r[`clickableColor${l(n)}`],g&&r.deletable,g&&n!=="default"&&r[`deletableColor${l(n)}`],r[p],r[`${p}${l(n)}`]]}})(ye(({theme:e})=>{const r=e.palette.mode==="light"?e.palette.grey[700]:e.palette.grey[300];return{maxWidth:"100%",fontFamily:e.typography.fontFamily,fontSize:e.typography.pxToRem(13),display:"inline-flex",alignItems:"center",justifyContent:"center",height:32,lineHeight:1.5,color:(e.vars||e).palette.text.primary,backgroundColor:(e.vars||e).palette.action.selected,borderRadius:32/2,whiteSpace:"nowrap",transition:e.transitions.create(["background-color","box-shadow"]),cursor:"unset",outline:0,textDecoration:"none",border:0,padding:0,verticalAlign:"middle",boxSizing:"border-box",[`&.${t.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity,pointerEvents:"none"},[`& .${t.avatar}`]:{marginLeft:5,marginRight:-6,width:24,height:24,color:e.vars?e.vars.palette.Chip.defaultAvatarColor:r,fontSize:e.typography.pxToRem(12)},[`& .${t.avatarColorPrimary}`]:{color:(e.vars||e).palette.primary.contrastText,backgroundColor:(e.vars||e).palette.primary.dark},[`& .${t.avatarColorSecondary}`]:{color:(e.vars||e).palette.secondary.contrastText,backgroundColor:(e.vars||e).palette.secondary.dark},[`& .${t.avatarSmall}`]:{marginLeft:4,marginRight:-4,width:18,height:18,fontSize:e.typography.pxToRem(10)},[`& .${t.icon}`]:{marginLeft:5,marginRight:-6},[`& .${t.deleteIcon}`]:{WebkitTapHighlightColor:"transparent",color:e.alpha((e.vars||e).palette.text.primary,.26),fontSize:22,cursor:"pointer",margin:"0 5px 0 -6px","&:hover":{color:e.alpha((e.vars||e).palette.text.primary,.4)}},variants:[{props:{size:"small"},style:{height:24,[`& .${t.icon}`]:{fontSize:18,marginLeft:4,marginRight:-4},[`& .${t.deleteIcon}`]:{fontSize:16,marginRight:4,marginLeft:-4}}},...Object.entries(e.palette).filter(z(["contrastText"])).map(([o])=>({props:{color:o},style:{backgroundColor:(e.vars||e).palette[o].main,color:(e.vars||e).palette[o].contrastText,[`& .${t.deleteIcon}`]:{color:e.alpha((e.vars||e).palette[o].contrastText,.7),"&:hover, &:active":{color:(e.vars||e).palette[o].contrastText}}}})),{props:o=>o.iconColor===o.color,style:{[`& .${t.icon}`]:{color:e.vars?e.vars.palette.Chip.defaultIconColor:r}}},{props:o=>o.iconColor===o.color&&o.color!=="default",style:{[`& .${t.icon}`]:{color:"inherit"}}},{props:{onDelete:!0},style:{[`&.${t.focusVisible}`]:{backgroundColor:e.alpha((e.vars||e).palette.action.selected,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.focusOpacity}`)}}},...Object.entries(e.palette).filter(z(["dark"])).map(([o])=>({props:{color:o,onDelete:!0},style:{[`&.${t.focusVisible}`]:{background:(e.vars||e).palette[o].dark}}})),{props:{clickable:!0},style:{userSelect:"none",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:hover":{backgroundColor:e.alpha((e.vars||e).palette.action.selected,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.hoverOpacity}`)},[`&.${t.focusVisible}`]:{backgroundColor:e.alpha((e.vars||e).palette.action.selected,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.focusOpacity}`)},"&:active":{boxShadow:(e.vars||e).shadows[1]}}},...Object.entries(e.palette).filter(z(["dark"])).map(([o])=>({props:{color:o,clickable:!0},style:{[`&:hover, &.${t.focusVisible}`]:{backgroundColor:(e.vars||e).palette[o].dark}}})),{props:{variant:"outlined"},style:{backgroundColor:"transparent",border:e.vars?`1px solid ${e.vars.palette.Chip.defaultBorder}`:`1px solid ${e.palette.mode==="light"?e.palette.grey[400]:e.palette.grey[700]}`,[`&.${t.clickable}:hover`]:{backgroundColor:(e.vars||e).palette.action.hover},[`&.${t.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`& .${t.avatar}`]:{marginLeft:4},[`& .${t.avatarSmall}`]:{marginLeft:2},[`& .${t.icon}`]:{marginLeft:4},[`& .${t.iconSmall}`]:{marginLeft:2},[`& .${t.deleteIcon}`]:{marginRight:5},[`& .${t.deleteIconSmall}`]:{marginRight:3}}},...Object.entries(e.palette).filter(z()).map(([o])=>({props:{variant:"outlined",color:o},style:{color:(e.vars||e).palette[o].main,border:`1px solid ${e.alpha((e.vars||e).palette[o].main,.7)}`,[`&.${t.clickable}:hover`]:{backgroundColor:e.alpha((e.vars||e).palette[o].main,(e.vars||e).palette.action.hoverOpacity)},[`&.${t.focusVisible}`]:{backgroundColor:e.alpha((e.vars||e).palette[o].main,(e.vars||e).palette.action.focusOpacity)},[`& .${t.deleteIcon}`]:{color:e.alpha((e.vars||e).palette[o].main,.7),"&:hover, &:active":{color:(e.vars||e).palette[o].main}}}}))]}})),Pe=q("span",{name:"MuiChip",slot:"Label",overridesResolver:(e,r)=>{const{ownerState:o}=e,{size:n}=o;return[r.label,r[`label${l(n)}`]]}})({overflow:"hidden",textOverflow:"ellipsis",paddingLeft:12,paddingRight:12,whiteSpace:"nowrap",variants:[{props:{variant:"outlined"},style:{paddingLeft:11,paddingRight:11}},{props:{size:"small"},style:{paddingLeft:8,paddingRight:8}},{props:{size:"small",variant:"outlined"},style:{paddingLeft:7,paddingRight:7}}]});function A(e){return e.key==="Backspace"||e.key==="Delete"}const Re=u.forwardRef(function(r,o){const n=de({props:r,name:"MuiChip"}),{avatar:i,className:v,clickable:g,color:d="default",component:p,deleteIcon:s,disabled:k=!1,icon:f,label:b,onClick:C,onDelete:x,onKeyDown:y,onKeyUp:N,size:h="medium",variant:m="filled",tabIndex:w,skipFocusWhenDisabled:G=!1,slots:Q={},slotProps:X={},...Y}=n,Z=u.useRef(null),ee=$e(Z,o),O=c=>{c.stopPropagation(),x(c)},ae=c=>{c.currentTarget===c.target&&A(c)&&c.preventDefault(),y&&y(c)},re=c=>{c.currentTarget===c.target&&x&&A(c)&&x(c),N&&N(c)},E=g!==!1&&C?!0:g,_=E||x?H:p||"div",L={...n,component:_,disabled:k,size:h,color:d,iconColor:u.isValidElement(f)&&f.props.color||d,onDelete:!!x,clickable:E,variant:m},j=Ne(L),oe=_===H?{component:p||"div",focusVisibleClassName:j.focusVisible,...x&&{disableRipple:!0}}:{};let T=null;x&&(T=s&&u.isValidElement(s)?u.cloneElement(s,{className:P(s.props.className,j.deleteIcon),onClick:O}):a.jsx(he,{className:j.deleteIcon,onClick:O}));let V=null;i&&u.isValidElement(i)&&(V=u.cloneElement(i,{className:P(j.avatar,i.props.className)}));let U=null;f&&u.isValidElement(f)&&(U=u.cloneElement(f,{className:P(j.icon,f.props.className)}));const K={slots:Q,slotProps:X},[te,le]=B("root",{elementType:we,externalForwardedProps:{...K,...Y},ownerState:L,shouldForwardComponentProp:!0,ref:ee,className:P(j.root,v),additionalProps:{disabled:E&&k?!0:void 0,tabIndex:G&&k?-1:w,...oe},getSlotProps:c=>({...c,onClick:$=>{c.onClick?.($),C?.($)},onKeyDown:$=>{c.onKeyDown?.($),ae($)},onKeyUp:$=>{c.onKeyUp?.($),re($)}})}),[se,ne]=B("label",{elementType:Pe,externalForwardedProps:K,ownerState:L,className:j.label});return a.jsxs(te,{as:_,...le,children:[V||U,a.jsx(se,{...ne,children:b}),T]})}),ze={neutral:"bg-surface text-muted border-border",ok:"bg-accent-soft text-accent border-accent",bad:"bg-[#fff5f5] text-danger border-danger",warn:"bg-amber-50 text-amber-700 border-amber-300"};function W({variant:e="neutral",children:r,className:o}){return a.jsx(Re,{label:r,variant:"outlined",size:"small",className:`${ze[e]} ${o||""}`})}function De(e){const r=e.match(/^\/part\/(\d+)$/);if(!r)return null;const o=Number(r[1]);return Number.isFinite(o)?o:null}function M({title:e,items:r,state:o}){const n=me(o).toString();return a.jsxs("div",{className:"rounded-md border border-border bg-surface p-4",children:[a.jsx("div",{className:"mb-2 text-sm font-medium",children:e}),r.length===0?a.jsx("p",{className:"text-sm text-muted",children:"无"}):a.jsx("div",{className:"grid gap-2",children:r.map(i=>a.jsx("a",{href:`/part/${encodeURIComponent(String(i.id))}${n?`?${n}`:""}`,className:"rounded-md border border-border bg-surface-soft px-3 py-2 font-mono text-xs transition-colors duration-fast ease-premium hover:bg-accent-soft",children:i.pn||i.part_number||"-"},i.id))})]})}function Ee(){const e=De(window.location.pathname),[r,o]=u.useState(null),[n,i]=u.useState(!0),[v,g]=u.useState(""),d=u.useMemo(()=>ge(window.location.search),[]),p=u.useMemo(()=>be(d),[d]);if(u.useEffect(()=>{if(!e){g("无效的零件 ID"),i(!1);return}(async()=>{try{const m=await fe(`/api/part/${e}`);o(m)}catch(m){g(String(m?.message||m))}finally{i(!1)}})()},[e]),n)return a.jsx(R,{backHref:p,children:a.jsx(D,{children:a.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted",children:[a.jsx(I,{name:"progress_activity",size:18,className:"animate-spin"}),"加载中..."]})})});if(v)return a.jsx(R,{backHref:p,children:a.jsx(je,{message:`加载失败：${v}`})});const s=r?.part;if(!s)return a.jsx(R,{backHref:p,children:a.jsx(xe,{title:"未找到零件信息"})});const k=String(s.pn||s.part_number_canonical||s.part_number_cell||"-"),f=String(s.source_relative_path||s.source_pdf||s.pdf||""),b=Number(s.page||s.page_num||1),C=Number(s.page_end||b),x=String(s.nom||s.nomenclature||s.nomenclature_clean||"").trim(),y=ke(x),N=Se(x||"-"),h=encodeURIComponent(f);return a.jsx(R,{backHref:p,children:a.jsxs("div",{className:"grid gap-4",children:[a.jsxs(D,{className:"grid gap-4",children:[a.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[a.jsx("a",{href:p,children:a.jsx(F,{variant:"ghost",children:"返回结果页"})}),a.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[a.jsx("a",{href:`/viewer.html?pdf=${h}&page=${b}`,target:"_blank",rel:"noreferrer",children:a.jsxs(F,{variant:"primary",className:"gap-2",children:[a.jsx(I,{name:"open_in_new",size:18}),"打开页面"]})}),a.jsx("a",{href:`/pdf/${h}#page=${b}`,target:"_blank",rel:"noreferrer",children:a.jsxs(F,{variant:"ghost",className:"gap-2",children:[a.jsx(I,{name:"description",size:18}),"原 PDF"]})})]})]}),a.jsxs("div",{className:"border-b border-border pb-3",children:[a.jsx("div",{className:"font-mono text-[30px] font-semibold leading-tight",children:k}),a.jsxs("p",{className:"mt-1 text-sm text-muted",children:[f||"-"," · 页 ",b,C!==b?`~${C}`:""]})]}),a.jsxs("div",{className:"grid gap-3 md:grid-cols-2 xl:grid-cols-3",children:[a.jsx(S,{label:"来源",value:f||"-"}),a.jsx(S,{label:"页码",value:C!==b?`${b}~${C}`:String(b)}),a.jsx(S,{label:"图号",value:String(s.fig||s.figure_code||"-")}),a.jsx(S,{label:"项号",value:String(s.fig_item||"-")}),a.jsx(S,{label:"数量",value:String(s.units||s.units_per_assy||"-")}),a.jsx(S,{label:"适用号段",value:String(s.eff||s.effectivity||"-")})]}),a.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.jsxs(W,{variant:y.optional?"ok":"neutral",children:["optional: ",y.optional?"是":"否"]}),a.jsxs(W,{variant:y.replace?"ok":"neutral",children:["replace: ",y.replace?"是":"否"]})]}),a.jsxs("div",{className:"rounded-md border border-border bg-surface-soft p-4",children:[a.jsx("div",{className:"mb-2 text-sm font-medium",children:"术语"}),a.jsx("p",{className:"whitespace-pre-wrap break-words text-sm leading-6 text-text",children:N.map((m,w)=>m.hit?a.jsx("mark",{className:"rounded-sm bg-accent-soft px-1 text-text",children:m.text},w):a.jsx(J.Fragment,{children:m.text},w))})]})]}),a.jsxs(D,{children:[a.jsxs("div",{className:"mb-3 flex items-center gap-2 text-sm font-medium",children:[a.jsx(I,{name:"account_tree",size:18,sx:{color:"text.secondary"}}),"层级关系"]}),a.jsxs("div",{className:"grid gap-3 md:grid-cols-2 xl:grid-cols-3",children:[a.jsx(M,{title:"父辈",items:r?.parents||[],state:d}),a.jsx(M,{title:"平辈",items:r?.siblings||[],state:d}),a.jsx(M,{title:"子辈",items:r?.children||[],state:d})]})]}),a.jsxs(D,{children:[a.jsxs("div",{className:"mb-2 flex items-center gap-2 text-sm font-medium",children:[a.jsx(I,{name:"link",size:18,sx:{color:"text.secondary"}}),"整页预览"]}),a.jsx("div",{className:"overflow-hidden rounded-md border border-border",children:a.jsx("img",{src:`/render/${h}/${b}.png`,alt:"PDF page preview",className:"block w-full bg-surface"})})]})]})})}function S({label:e,value:r}){return a.jsxs("div",{className:"rounded-md border border-border bg-surface p-3",children:[a.jsx("div",{className:"text-[10px] uppercase tracking-wider text-muted",children:e}),a.jsx("div",{className:"mt-1 font-mono text-sm font-medium text-text",children:r})]})}pe.createRoot(document.getElementById("root")).render(a.jsx(J.StrictMode,{children:a.jsx(ue,{children:a.jsx(Ee,{})})}));
