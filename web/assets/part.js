import{r as l,j as e,D as b,M as u,R,c as V,A as q}from"./chunks/AppProviders.js";import{s as Q,a as W,p as X,f as Y,E as Z,B as ee,c as te}from"./chunks/urlState.js";import{C as f}from"./chunks/Card.js";import{E as se,a as ae,d as re}from"./chunks/keyword.js";function c(r){return String(r??"").trim()||"-"}function ne(r){const{pathname:n,search:a}=r,o=n.match(/^\/part\/(\d+)\/?$/),i=o?Number(o[1]):NaN;if(Number.isFinite(i)&&i>0)return i;const g=new URLSearchParams(a||""),d=Number(g.get("id")||"");return Number.isFinite(d)&&d>0?d:null}function v({title:r,items:n,state:a}){const o=te(a).toString();return e.jsxs("div",{className:"rounded-md border border-border bg-surface p-4",children:[e.jsx("div",{className:"mb-2 text-sm font-medium",children:r}),n.length===0?e.jsx("p",{className:"text-sm text-muted",children:"无"}):e.jsx("div",{className:"grid gap-2",children:n.map(i=>e.jsx("a",{href:`/part.html?id=${encodeURIComponent(String(i.id))}${o?`&${o}`:""}`,className:"rounded-md border border-border bg-surface-soft px-3 py-2 font-mono text-xs transition-colors duration-fast ease-premium hover:bg-accent-soft",children:i.pn||i.part_number||"-"},i.id))})]})}function ie(){const r=[{href:"/db.html",label:"数据库"}],n=ne(window.location),[a,o]=l.useState(null),[i,g]=l.useState(!0),[d,N]=l.useState(""),[z,_]=l.useState(!1),p=l.useMemo(()=>Q(window.location.search),[]),w=l.useMemo(()=>W(p),[p]),h=l.useMemo(()=>X(window.location.search,w),[w]);if(l.useEffect(()=>{_(!1)},[n,a?.part?.source_relative_path,a?.part?.source_pdf,a?.part?.pdf,a?.part?.page,a?.part?.page_num,a?.part?.page_end]),l.useEffect(()=>{if(!n){N("无效的零件 ID"),g(!1);return}(async()=>{try{const s=await Y(`/api/part/${n}`);o(s)}catch(s){N(String(s?.message||s))}finally{g(!1)}})()},[n]),i)return e.jsx(b,{backHref:h,actions:r,children:e.jsx(f,{children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted",children:[e.jsx(u,{name:"progress_activity",size:18,className:"animate-spin"}),"加载中..."]})})});if(d)return e.jsx(b,{backHref:h,actions:r,children:e.jsx(se,{message:`加载失败：${d}`,actionLabel:"重试",onAction:()=>window.location.reload()})});const t=a?.part;if(!t)return e.jsx(b,{backHref:h,actions:r,children:e.jsx(Z,{title:"未找到零件信息"})});const D=String(t.pn||t.part_number_canonical||t.part_number_cell||"-"),j=String(t.source_relative_path||t.source_pdf||t.pdf||"").trim(),S=c(j),m=Number(t.page||t.page_num||1),y=Number(t.page_end||m),k=y!==m?`${m}~${y}`:String(m),E=String(t.nom||t.nomenclature||t.nomenclature_clean||"").trim(),P=re(E),H=ae(E||"-"),M=c(t.fig||t.figure_code),U=c(t.fig_item),A=c(t.units||t.units_per_assy),B=c(t.eff||t.effectivity),C=c(t.figure_label),L=c(t.date_text),T=c(t.page_token),G=String(t.rf_text||"").trim(),F=encodeURIComponent(j),J=`/pdf/${F}#page=${m}`,x=!!j,K=[{label:"来源",value:S},{label:"页码",value:k},{label:"图号",value:M},{label:"项号",value:U},{label:"数量",value:A},{label:"适用号段",value:B}],O=[{label:"页脚图标",value:C},{label:"页脚日期",value:L},{label:"页脚 PAGE",value:T},{label:"页脚 RF",value:c(G)},{label:"是否含 optional",value:P.optional?"是":"否"},{label:"是否含 replace",value:P.replace?"是":"否"}];return e.jsx(b,{backHref:h,actions:r,children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs(f,{className:"grid gap-4 p-5",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-4 border-b border-border pb-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-mono text-[32px] font-semibold leading-tight text-text",children:D}),e.jsxs("p",{className:"mt-1 text-sm text-muted",children:[S," · 页 ",k]})]}),e.jsxs(ee,{component:"a",href:x?J:void 0,target:x?"_blank":void 0,rel:x?"noreferrer":void 0,variant:"primary",className:"gap-2",disabled:!x,children:[e.jsx(u,{name:"description",size:18}),"打开 PDF"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-sm font-medium text-text",children:"基础信息"}),e.jsx("div",{className:"grid gap-3 md:grid-cols-2 xl:grid-cols-6",children:K.map(s=>e.jsx(I,{label:s.label,value:s.value},s.label))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-sm font-medium text-text",children:"页脚信息"}),e.jsx("div",{className:"grid gap-3 md:grid-cols-2 xl:grid-cols-6",children:O.map(s=>e.jsx(I,{label:s.label,value:s.value},s.label))})]})]}),e.jsxs(f,{children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2 text-sm font-medium",children:[e.jsx(u,{name:"notes",size:18,sx:{color:"text.secondary"}}),"术语"]}),e.jsx("div",{className:"rounded-md border border-border bg-surface-soft p-4",children:e.jsx("p",{className:"whitespace-pre-wrap break-words text-sm leading-6 text-text",children:H.map((s,$)=>s.hit?e.jsx("mark",{className:"kw-hit",children:s.text},$):e.jsx(R.Fragment,{children:s.text},$))})})]}),e.jsxs("div",{className:"grid gap-4 xl:grid-cols-[minmax(0,1.25fr)_minmax(320px,0.75fr)]",children:[e.jsxs(f,{children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2 text-sm font-medium",children:[e.jsx(u,{name:"link",size:18,sx:{color:"text.secondary"}}),"整页预览"]}),e.jsx("div",{className:"overflow-hidden rounded-md border border-border bg-surface",children:x&&!z?e.jsx("img",{src:`/render/${F}/${m}.png`,alt:"PDF page preview",className:"block w-full bg-surface",onError:()=>_(!0)}):x?e.jsxs("div",{className:"grid gap-2 p-8 text-center text-sm text-muted",children:[e.jsx("div",{children:"预览加载失败"}),e.jsx("div",{children:"请点击“打开 PDF”查看原文"})]}):e.jsx("div",{className:"p-8 text-center text-sm text-muted",children:"暂无预览"})})]}),e.jsxs(f,{className:"content-start",children:[e.jsxs("div",{className:"mb-3 flex items-center gap-2 text-sm font-medium",children:[e.jsx(u,{name:"account_tree",size:18,sx:{color:"text.secondary"}}),"层级关系"]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(v,{title:"父辈",items:a?.parents||[],state:p}),e.jsx(v,{title:"平辈",items:a?.siblings||[],state:p}),e.jsx(v,{title:"子辈",items:a?.children||[],state:p})]})]})]})]})})}function I({label:r,value:n}){return e.jsxs("div",{className:"rounded-md border border-border bg-surface p-3",children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wider text-muted",children:r}),e.jsx("div",{className:"mt-1 break-all font-mono text-sm font-medium text-text",children:n})]})}V.createRoot(document.getElementById("root")).render(e.jsx(R.StrictMode,{children:e.jsx(q,{children:e.jsx(ie,{})})}));
