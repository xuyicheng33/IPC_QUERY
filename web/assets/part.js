import{r as x,j as e,C as j,M as h,B as S,R as $,c as F,A as H}from"./chunks/AppProviders.js";import{A as b}from"./chunks/AppShell.js";import{s as I,a as M,f as R,E as z,B as k,c as B}from"./chunks/urlState.js";import{E as U}from"./chunks/ErrorState.js";function A(r){const t=String(r||"");return{optional:/\boptional\b/i.test(t),replace:/\breplace\b/i.test(t)}}function C(r){const t=String(r);if(!t)return[{text:"",hit:!1}];const n=[],d=/\b(optional|replace)\b/gi;let a=0,m=null;for(;(m=d.exec(t))!==null;){const o=m.index,l=o+m[0].length;o>a&&n.push({text:t.slice(a,o),hit:!1}),n.push({text:t.slice(o,l),hit:!0}),a=l}return a<t.length&&n.push({text:t.slice(a),hit:!1}),n.length?n:[{text:t,hit:!1}]}function D(r){const t=r.match(/^\/part\/(\d+)$/);if(!t)return null;const n=Number(t[1]);return Number.isFinite(n)?n:null}function _({title:r,items:t,state:n}){const d=B(n).toString();return e.jsxs("div",{className:"rounded-md border border-border bg-surface p-4",children:[e.jsx("div",{className:"mb-2 text-sm font-medium",children:r}),t.length===0?e.jsx("p",{className:"text-sm text-muted",children:"无"}):e.jsx("div",{className:"grid gap-2",children:t.map(a=>e.jsx("a",{href:`/part/${encodeURIComponent(String(a.id))}${d?`?${d}`:""}`,className:"rounded-md border border-border bg-surface-soft px-3 py-2 font-mono text-xs transition-colors duration-fast ease-premium hover:bg-accent-soft",children:a.pn||a.part_number||"-"},a.id))})]})}function L(){const r=D(window.location.pathname),[t,n]=x.useState(null),[d,a]=x.useState(!0),[m,o]=x.useState(""),l=x.useMemo(()=>I(window.location.search),[]),u=x.useMemo(()=>M(l),[l]);if(x.useEffect(()=>{if(!r){o("无效的零件 ID"),a(!1);return}(async()=>{try{const c=await R(`/api/part/${r}`);n(c)}catch(c){o(String(c?.message||c))}finally{a(!1)}})()},[r]),d)return e.jsx(b,{backHref:u,children:e.jsx(j,{children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted",children:[e.jsx(h,{name:"progress_activity",size:18,className:"animate-spin"}),"加载中..."]})})});if(m)return e.jsx(b,{backHref:u,children:e.jsx(U,{message:`加载失败：${m}`})});const s=t?.part;if(!s)return e.jsx(b,{backHref:u,children:e.jsx(z,{title:"未找到零件信息"})});const E=String(s.pn||s.part_number_canonical||s.part_number_cell||"-"),v=String(s.source_relative_path||s.source_pdf||s.pdf||""),i=Number(s.page||s.page_num||1),g=Number(s.page_end||i),w=String(s.nom||s.nomenclature||s.nomenclature_clean||"").trim(),f=A(w),P=C(w||"-"),N=encodeURIComponent(v);return e.jsx(b,{backHref:u,children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs(j,{className:"grid gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsx("a",{href:u,children:e.jsx(S,{variant:"ghost",children:"返回结果页"})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("a",{href:`/viewer.html?pdf=${N}&page=${i}`,target:"_blank",rel:"noreferrer",children:e.jsxs(S,{variant:"primary",className:"gap-2",children:[e.jsx(h,{name:"open_in_new",size:18}),"打开页面"]})}),e.jsx("a",{href:`/pdf/${N}#page=${i}`,target:"_blank",rel:"noreferrer",children:e.jsxs(S,{variant:"ghost",className:"gap-2",children:[e.jsx(h,{name:"description",size:18}),"原 PDF"]})})]})]}),e.jsxs("div",{className:"border-b border-border pb-3",children:[e.jsx("div",{className:"font-mono text-[30px] font-semibold leading-tight",children:E}),e.jsxs("p",{className:"mt-1 text-sm text-muted",children:[v||"-"," · 页 ",i,g!==i?`~${g}`:""]})]}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2 xl:grid-cols-3",children:[e.jsx(p,{label:"来源",value:v||"-"}),e.jsx(p,{label:"页码",value:g!==i?`${i}~${g}`:String(i)}),e.jsx(p,{label:"图号",value:String(s.fig||s.figure_code||"-")}),e.jsx(p,{label:"项号",value:String(s.fig_item||"-")}),e.jsx(p,{label:"数量",value:String(s.units||s.units_per_assy||"-")}),e.jsx(p,{label:"适用号段",value:String(s.eff||s.effectivity||"-")})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(k,{variant:f.optional?"ok":"neutral",children:["optional: ",f.optional?"是":"否"]}),e.jsxs(k,{variant:f.replace?"ok":"neutral",children:["replace: ",f.replace?"是":"否"]})]}),e.jsxs("div",{className:"rounded-md border border-border bg-surface-soft p-4",children:[e.jsx("div",{className:"mb-2 text-sm font-medium",children:"术语"}),e.jsx("p",{className:"whitespace-pre-wrap break-words text-sm leading-6 text-text",children:P.map((c,y)=>c.hit?e.jsx("mark",{className:"rounded-sm bg-accent-soft px-1 text-text",children:c.text},y):e.jsx($.Fragment,{children:c.text},y))})]})]}),e.jsxs(j,{children:[e.jsxs("div",{className:"mb-3 flex items-center gap-2 text-sm font-medium",children:[e.jsx(h,{name:"account_tree",size:18,sx:{color:"text.secondary"}}),"层级关系"]}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2 xl:grid-cols-3",children:[e.jsx(_,{title:"父辈",items:t?.parents||[],state:l}),e.jsx(_,{title:"平辈",items:t?.siblings||[],state:l}),e.jsx(_,{title:"子辈",items:t?.children||[],state:l})]})]}),e.jsxs(j,{children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2 text-sm font-medium",children:[e.jsx(h,{name:"link",size:18,sx:{color:"text.secondary"}}),"整页预览"]}),e.jsx("div",{className:"overflow-hidden rounded-md border border-border",children:e.jsx("img",{src:`/render/${N}/${i}.png`,alt:"PDF page preview",className:"block w-full bg-surface"})})]})]})})}function p({label:r,value:t}){return e.jsxs("div",{className:"rounded-md border border-border bg-surface p-3",children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wider text-muted",children:r}),e.jsx("div",{className:"mt-1 font-mono text-sm font-medium text-text",children:t})]})}F.createRoot(document.getElementById("root")).render(e.jsx($.StrictMode,{children:e.jsx(H,{children:e.jsx(L,{})})}));
