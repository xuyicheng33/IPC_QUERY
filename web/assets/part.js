import{c as w,r as h,j as e,C as g,B as N,R as k,a as F}from"./chunks/Card.js";import{s as P,A as f,a as R,c as I}from"./chunks/urlState.js";import{f as L,E as q,B as _}from"./chunks/api.js";import{E as A}from"./chunks/ErrorState.js";import{R as B,F as C}from"./chunks/refresh-cw.js";const U=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],D=w("external-link",U);const H=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],z=w("layers",H);const J=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],K=w("link-2",J);function T(r){const t=String(r||"");return{optional:/\boptional\b/i.test(t),replace:/\breplace\b/i.test(t)}}function V(r){const t=String(r);if(!t)return[{text:"",hit:!1}];const n=[],o=/\b(optional|replace)\b/gi;let a=0,m=null;for(;(m=o.exec(t))!==null;){const c=m.index,d=c+m[0].length;c>a&&n.push({text:t.slice(a,c),hit:!1}),n.push({text:t.slice(c,d),hit:!0}),a=d}return a<t.length&&n.push({text:t.slice(a),hit:!1}),n.length?n:[{text:t,hit:!1}]}function G(r){const t=r.match(/^\/part\/(\d+)$/);if(!t)return null;const n=Number(t[1]);return Number.isFinite(n)?n:null}function v({title:r,items:t,state:n}){const o=I(n).toString();return e.jsxs("div",{className:"rounded-md border border-border bg-surface p-4",children:[e.jsx("div",{className:"mb-2 text-sm font-medium",children:r}),t.length===0?e.jsx("p",{className:"text-sm text-muted",children:"无"}):e.jsx("div",{className:"grid gap-2",children:t.map(a=>e.jsx("a",{href:`/part/${encodeURIComponent(String(a.id))}${o?`?${o}`:""}`,className:"rounded-md border border-border bg-surface-soft px-3 py-2 font-mono text-xs transition-colors duration-fast ease-premium hover:bg-accent-soft",children:a.pn||a.part_number||"-"},a.id))})]})}function O(){const r=G(window.location.pathname),[t,n]=h.useState(null),[o,a]=h.useState(!0),[m,c]=h.useState(""),d=h.useMemo(()=>P(window.location.search),[]);if(h.useEffect(()=>{if(!r){c("无效的零件 ID"),a(!1);return}(async()=>{try{const l=await L(`/api/part/${r}`);n(l)}catch(l){c(String(l?.message||l))}finally{a(!1)}})()},[r]),o)return e.jsx(f,{children:e.jsx(g,{children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted",children:[e.jsx(B,{className:"h-4 w-4 animate-spin","aria-hidden":"true"}),"加载中..."]})})});if(m)return e.jsx(f,{children:e.jsx(A,{message:`加载失败：${m}`})});const s=t?.part;if(!s)return e.jsx(f,{children:e.jsx(q,{title:"未找到零件信息"})});const $=String(s.pn||s.part_number_canonical||s.part_number_cell||"-"),j=String(s.source_relative_path||s.source_pdf||s.pdf||""),i=Number(s.page||s.page_num||1),p=Number(s.page_end||i),y=String(s.nom||s.nomenclature||s.nomenclature_clean||"").trim(),u=T(y),E=V(y||"-"),b=encodeURIComponent(j),M=R(d);return e.jsx(f,{children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs(g,{className:"grid gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsx("a",{href:M,children:e.jsx(N,{variant:"ghost",children:"返回结果页"})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("a",{href:`/viewer.html?pdf=${b}&page=${i}`,target:"_blank",rel:"noreferrer",children:e.jsxs(N,{variant:"ghost",className:"gap-2",children:[e.jsx(D,{className:"h-4 w-4","aria-hidden":"true"}),"打开页面"]})}),e.jsx("a",{href:`/pdf/${b}#page=${i}`,target:"_blank",rel:"noreferrer",children:e.jsxs(N,{variant:"ghost",className:"gap-2",children:[e.jsx(C,{className:"h-4 w-4","aria-hidden":"true"}),"原 PDF"]})})]})]}),e.jsxs("div",{className:"border-b border-border pb-3",children:[e.jsx("div",{className:"font-mono text-[30px] font-semibold leading-tight",children:$}),e.jsxs("p",{className:"mt-1 text-sm text-muted",children:[j||"-"," · 页 ",i,p!==i?`~${p}`:""]})]}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2 xl:grid-cols-3",children:[e.jsx(x,{label:"来源",value:j||"-"}),e.jsx(x,{label:"页码",value:p!==i?`${i}~${p}`:String(i)}),e.jsx(x,{label:"图号",value:String(s.fig||s.figure_code||"-")}),e.jsx(x,{label:"项号",value:String(s.fig_item||"-")}),e.jsx(x,{label:"数量",value:String(s.units||s.units_per_assy||"-")}),e.jsx(x,{label:"适用号段",value:String(s.eff||s.effectivity||"-")})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(_,{variant:u.optional?"ok":"neutral",children:["optional: ",u.optional?"是":"否"]}),e.jsxs(_,{variant:u.replace?"ok":"neutral",children:["replace: ",u.replace?"是":"否"]})]}),e.jsxs("div",{className:"rounded-md border border-border bg-surface-soft p-4",children:[e.jsx("div",{className:"mb-2 text-sm font-medium",children:"术语"}),e.jsx("p",{className:"whitespace-pre-wrap break-words text-sm leading-6 text-text",children:E.map((l,S)=>l.hit?e.jsx("mark",{className:"rounded-sm bg-accent-soft px-1 text-text",children:l.text},S):e.jsx(k.Fragment,{children:l.text},S))})]})]}),e.jsxs(g,{children:[e.jsxs("div",{className:"mb-3 flex items-center gap-2 text-sm font-medium",children:[e.jsx(z,{className:"h-4 w-4 text-muted","aria-hidden":"true"}),"层级关系"]}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2 xl:grid-cols-3",children:[e.jsx(v,{title:"父辈",items:t?.parents||[],state:d}),e.jsx(v,{title:"平辈",items:t?.siblings||[],state:d}),e.jsx(v,{title:"子辈",items:t?.children||[],state:d})]})]}),e.jsxs(g,{children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2 text-sm font-medium",children:[e.jsx(K,{className:"h-4 w-4 text-muted","aria-hidden":"true"}),"整页预览"]}),e.jsx("div",{className:"rounded-md border border-border bg-surface-soft p-3",children:e.jsx("img",{src:`/render/${b}/${i}.png`,alt:"PDF page preview",className:"w-full rounded-md border border-border bg-surface"})})]})]})})}function x({label:r,value:t}){return e.jsxs("div",{className:"rounded-md border border-border bg-surface p-3",children:[e.jsx("div",{className:"text-xs text-muted",children:r}),e.jsx("div",{className:"mt-1 font-mono text-sm text-text",children:t})]})}F.createRoot(document.getElementById("root")).render(e.jsx(k.StrictMode,{children:e.jsx(O,{})}));
