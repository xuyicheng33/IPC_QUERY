import{r as c,j as e,D as b,M as u,R,c as J,A as K}from"./chunks/AppProviders.js";import{s as O,a as V,p as q,f as Q,E as W,B as X,c as Y}from"./chunks/urlState.js";import{C as f}from"./chunks/Card.js";import{E as Z,a as ee,d as te}from"./chunks/keyword.js";function l(a){return String(a??"").trim()||"-"}function se(a){const{pathname:r,search:s}=a,o=r.match(/^\/part\/(\d+)\/?$/),i=o?Number(o[1]):NaN;if(Number.isFinite(i)&&i>0)return i;const g=new URLSearchParams(s||""),d=Number(g.get("id")||"");return Number.isFinite(d)&&d>0?d:null}function v({title:a,items:r,state:s}){const o=Y(s).toString();return e.jsxs("div",{className:"rounded-md border border-border bg-surface p-4",children:[e.jsx("div",{className:"mb-2 text-sm font-medium",children:a}),r.length===0?e.jsx("p",{className:"text-sm text-muted",children:"无"}):e.jsx("div",{className:"grid gap-2",children:r.map(i=>e.jsx("a",{href:`/part.html?id=${encodeURIComponent(String(i.id))}${o?`&${o}`:""}`,className:"rounded-md border border-border bg-surface-soft px-3 py-2 font-mono text-xs transition-colors duration-fast ease-premium hover:bg-accent-soft",children:i.pn||i.part_number||"-"},i.id))})]})}function ae(){const a=[{href:"/db.html",label:"数据库"}],r=se(window.location),[s,o]=c.useState(null),[i,g]=c.useState(!0),[d,N]=c.useState(""),[I,_]=c.useState(!1),x=c.useMemo(()=>O(window.location.search),[]),w=c.useMemo(()=>V(x),[x]),h=c.useMemo(()=>q(window.location.search,w),[w]);if(c.useEffect(()=>{_(!1)},[r,s?.part?.source_relative_path,s?.part?.source_pdf,s?.part?.pdf,s?.part?.page,s?.part?.page_num,s?.part?.page_end]),c.useEffect(()=>{if(!r){N("无效的零件 ID"),g(!1);return}(async()=>{try{const n=await Q(`/api/part/${r}`);o(n)}catch(n){N(String(n?.message||n))}finally{g(!1)}})()},[r]),i)return e.jsx(b,{backHref:h,actions:a,children:e.jsx(f,{children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted",children:[e.jsx(u,{name:"progress_activity",size:18,className:"animate-spin"}),"加载中..."]})})});if(d)return e.jsx(b,{backHref:h,actions:a,children:e.jsx(Z,{message:`加载失败：${d}`,actionLabel:"重试",onAction:()=>window.location.reload()})});const t=s?.part;if(!t)return e.jsx(b,{backHref:h,actions:a,children:e.jsx(W,{title:"未找到零件信息"})});const z=String(t.pn||t.part_number_canonical||t.part_number_cell||"-"),j=String(t.source_relative_path||t.source_pdf||t.pdf||"").trim(),S=l(j),m=Number(t.page||t.page_num||1),y=Number(t.page_end||m),k=y!==m?`${m}~${y}`:String(m),E=String(t.nom||t.nomenclature||t.nomenclature_clean||"").trim(),P=te(E),D=ee(E||"-"),H=l(t.fig||t.figure_code),M=l(t.fig_item),U=l(t.units||t.units_per_assy),A=l(t.eff||t.effectivity),B=l(t.figure_label),C=l(t.date_text),L=l(t.page_token),$=encodeURIComponent(j),T=`/pdf/${$}#page=${m}`,p=!!j,G=[{label:"来源",value:S},{label:"页码",value:k},{label:"图号",value:H},{label:"项号",value:M},{label:"数量",value:U},{label:"适用号段",value:A},{label:"页脚图标",value:B},{label:"页脚日期",value:C},{label:"页脚 PAGE",value:L},{label:"是否含 optional",value:P.optional?"是":"否"},{label:"是否含 replace",value:P.replace?"是":"否"}];return e.jsx(b,{backHref:h,actions:a,children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs(f,{className:"grid gap-4 p-5",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-4 border-b border-border pb-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-mono text-[32px] font-semibold leading-tight text-text",children:z}),e.jsxs("p",{className:"mt-1 text-sm text-muted",children:[S," · 页 ",k]})]}),e.jsxs(X,{component:"a",href:p?T:void 0,target:p?"_blank":void 0,rel:p?"noreferrer":void 0,variant:"primary",className:"gap-2",disabled:!p,children:[e.jsx(u,{name:"description",size:18}),"打开 PDF"]})]}),e.jsx("div",{className:"grid gap-3 md:grid-cols-2 xl:grid-cols-6",children:G.map(n=>e.jsx(re,{label:n.label,value:n.value},n.label))})]}),e.jsxs(f,{children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2 text-sm font-medium",children:[e.jsx(u,{name:"notes",size:18,sx:{color:"text.secondary"}}),"术语"]}),e.jsx("div",{className:"rounded-md border border-border bg-surface-soft p-4",children:e.jsx("p",{className:"whitespace-pre-wrap break-words text-sm leading-6 text-text",children:D.map((n,F)=>n.hit?e.jsx("mark",{className:"kw-hit",children:n.text},F):e.jsx(R.Fragment,{children:n.text},F))})})]}),e.jsxs("div",{className:"grid gap-4 xl:grid-cols-[minmax(0,1.25fr)_minmax(320px,0.75fr)]",children:[e.jsxs(f,{children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2 text-sm font-medium",children:[e.jsx(u,{name:"link",size:18,sx:{color:"text.secondary"}}),"整页预览"]}),e.jsx("div",{className:"overflow-hidden rounded-md border border-border bg-surface",children:p&&!I?e.jsx("img",{src:`/render/${$}/${m}.png`,alt:"PDF page preview",className:"block w-full bg-surface",onError:()=>_(!0)}):p?e.jsxs("div",{className:"grid gap-2 p-8 text-center text-sm text-muted",children:[e.jsx("div",{children:"预览加载失败"}),e.jsx("div",{children:"请点击“打开 PDF”查看原文"})]}):e.jsx("div",{className:"p-8 text-center text-sm text-muted",children:"暂无预览"})})]}),e.jsxs(f,{className:"content-start",children:[e.jsxs("div",{className:"mb-3 flex items-center gap-2 text-sm font-medium",children:[e.jsx(u,{name:"account_tree",size:18,sx:{color:"text.secondary"}}),"层级关系"]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(v,{title:"父辈",items:s?.parents||[],state:x}),e.jsx(v,{title:"平辈",items:s?.siblings||[],state:x}),e.jsx(v,{title:"子辈",items:s?.children||[],state:x})]})]})]})]})})}function re({label:a,value:r}){return e.jsxs("div",{className:"rounded-md border border-border bg-surface p-3",children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wider text-muted",children:a}),e.jsx("div",{className:"mt-1 break-all font-mono text-sm font-medium text-text",children:r})]})}J.createRoot(document.getElementById("root")).render(e.jsx(R.StrictMode,{children:e.jsx(K,{children:e.jsx(ae,{})})}));
