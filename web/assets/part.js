import{j as a,g as ie,a as ce,r as p,u as de,b as R,d as n,M as N,R as Q,c as pe,A as ue}from"./chunks/AppProviders.js";import{D as z,C as D}from"./chunks/Card.js";import{d as ge,u as be,B as A,e as W,f as fe,g as X,m as me,h as E,s as xe,a as ve,p as $e,i as Ce,j as J,c as ye}from"./chunks/urlState.js";import{f as je,E as Se}from"./chunks/api.js";import{E as ke,a as he,d as we}from"./chunks/keyword.js";const Ne=ge(a.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"}));function Ie(e){return ie("MuiChip",e)}const t=ce("MuiChip",["root","sizeSmall","sizeMedium","colorDefault","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","disabled","clickable","clickableColorPrimary","clickableColorSecondary","deletable","deletableColorPrimary","deletableColorSecondary","outlined","filled","outlinedPrimary","outlinedSecondary","filledPrimary","filledSecondary","avatar","avatarSmall","avatarMedium","avatarColorPrimary","avatarColorSecondary","icon","iconSmall","iconMedium","iconColorPrimary","iconColorSecondary","label","labelSmall","labelMedium","deleteIcon","deleteIconSmall","deleteIconMedium","deleteIconColorPrimary","deleteIconColorSecondary","deleteIconOutlinedColorPrimary","deleteIconOutlinedColorSecondary","deleteIconFilledColorPrimary","deleteIconFilledColorSecondary","focusVisible"]),Pe=e=>{const{classes:r,disabled:o,size:l,color:s,iconColor:m,onDelete:u,clickable:d,variant:g}=e,x={root:["root",g,o&&"disabled",`size${n(l)}`,`color${n(s)}`,d&&"clickable",d&&`clickableColor${n(s)}`,u&&"deletable",u&&`deletableColor${n(s)}`,`${g}${n(s)}`],label:["label",`label${n(l)}`],avatar:["avatar",`avatar${n(l)}`,`avatarColor${n(s)}`],icon:["icon",`icon${n(l)}`,`iconColor${n(m)}`],deleteIcon:["deleteIcon",`deleteIcon${n(l)}`,`deleteIconColor${n(s)}`,`deleteIcon${n(g)}Color${n(s)}`]};return fe(x,Ie,r)},Re=X("div",{name:"MuiChip",slot:"Root",overridesResolver:(e,r)=>{const{ownerState:o}=e,{color:l,iconColor:s,clickable:m,onDelete:u,size:d,variant:g}=o;return[{[`& .${t.avatar}`]:r.avatar},{[`& .${t.avatar}`]:r[`avatar${n(d)}`]},{[`& .${t.avatar}`]:r[`avatarColor${n(l)}`]},{[`& .${t.icon}`]:r.icon},{[`& .${t.icon}`]:r[`icon${n(d)}`]},{[`& .${t.icon}`]:r[`iconColor${n(s)}`]},{[`& .${t.deleteIcon}`]:r.deleteIcon},{[`& .${t.deleteIcon}`]:r[`deleteIcon${n(d)}`]},{[`& .${t.deleteIcon}`]:r[`deleteIconColor${n(l)}`]},{[`& .${t.deleteIcon}`]:r[`deleteIcon${n(g)}Color${n(l)}`]},r.root,r[`size${n(d)}`],r[`color${n(l)}`],m&&r.clickable,m&&l!=="default"&&r[`clickableColor${n(l)}`],u&&r.deletable,u&&l!=="default"&&r[`deletableColor${n(l)}`],r[g],r[`${g}${n(l)}`]]}})(me(({theme:e})=>{const r=e.palette.mode==="light"?e.palette.grey[700]:e.palette.grey[300];return{maxWidth:"100%",fontFamily:e.typography.fontFamily,fontSize:e.typography.pxToRem(13),display:"inline-flex",alignItems:"center",justifyContent:"center",height:32,lineHeight:1.5,color:(e.vars||e).palette.text.primary,backgroundColor:(e.vars||e).palette.action.selected,borderRadius:32/2,whiteSpace:"nowrap",transition:e.transitions.create(["background-color","box-shadow"]),cursor:"unset",outline:0,textDecoration:"none",border:0,padding:0,verticalAlign:"middle",boxSizing:"border-box",[`&.${t.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity,pointerEvents:"none"},[`& .${t.avatar}`]:{marginLeft:5,marginRight:-6,width:24,height:24,color:e.vars?e.vars.palette.Chip.defaultAvatarColor:r,fontSize:e.typography.pxToRem(12)},[`& .${t.avatarColorPrimary}`]:{color:(e.vars||e).palette.primary.contrastText,backgroundColor:(e.vars||e).palette.primary.dark},[`& .${t.avatarColorSecondary}`]:{color:(e.vars||e).palette.secondary.contrastText,backgroundColor:(e.vars||e).palette.secondary.dark},[`& .${t.avatarSmall}`]:{marginLeft:4,marginRight:-4,width:18,height:18,fontSize:e.typography.pxToRem(10)},[`& .${t.icon}`]:{marginLeft:5,marginRight:-6},[`& .${t.deleteIcon}`]:{WebkitTapHighlightColor:"transparent",color:e.alpha((e.vars||e).palette.text.primary,.26),fontSize:22,cursor:"pointer",margin:"0 5px 0 -6px","&:hover":{color:e.alpha((e.vars||e).palette.text.primary,.4)}},variants:[{props:{size:"small"},style:{height:24,[`& .${t.icon}`]:{fontSize:18,marginLeft:4,marginRight:-4},[`& .${t.deleteIcon}`]:{fontSize:16,marginRight:4,marginLeft:-4}}},...Object.entries(e.palette).filter(E(["contrastText"])).map(([o])=>({props:{color:o},style:{backgroundColor:(e.vars||e).palette[o].main,color:(e.vars||e).palette[o].contrastText,[`& .${t.deleteIcon}`]:{color:e.alpha((e.vars||e).palette[o].contrastText,.7),"&:hover, &:active":{color:(e.vars||e).palette[o].contrastText}}}})),{props:o=>o.iconColor===o.color,style:{[`& .${t.icon}`]:{color:e.vars?e.vars.palette.Chip.defaultIconColor:r}}},{props:o=>o.iconColor===o.color&&o.color!=="default",style:{[`& .${t.icon}`]:{color:"inherit"}}},{props:{onDelete:!0},style:{[`&.${t.focusVisible}`]:{backgroundColor:e.alpha((e.vars||e).palette.action.selected,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.focusOpacity}`)}}},...Object.entries(e.palette).filter(E(["dark"])).map(([o])=>({props:{color:o,onDelete:!0},style:{[`&.${t.focusVisible}`]:{background:(e.vars||e).palette[o].dark}}})),{props:{clickable:!0},style:{userSelect:"none",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:hover":{backgroundColor:e.alpha((e.vars||e).palette.action.selected,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.hoverOpacity}`)},[`&.${t.focusVisible}`]:{backgroundColor:e.alpha((e.vars||e).palette.action.selected,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.focusOpacity}`)},"&:active":{boxShadow:(e.vars||e).shadows[1]}}},...Object.entries(e.palette).filter(E(["dark"])).map(([o])=>({props:{color:o,clickable:!0},style:{[`&:hover, &.${t.focusVisible}`]:{backgroundColor:(e.vars||e).palette[o].dark}}})),{props:{variant:"outlined"},style:{backgroundColor:"transparent",border:e.vars?`1px solid ${e.vars.palette.Chip.defaultBorder}`:`1px solid ${e.palette.mode==="light"?e.palette.grey[400]:e.palette.grey[700]}`,[`&.${t.clickable}:hover`]:{backgroundColor:(e.vars||e).palette.action.hover},[`&.${t.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`& .${t.avatar}`]:{marginLeft:4},[`& .${t.avatarSmall}`]:{marginLeft:2},[`& .${t.icon}`]:{marginLeft:4},[`& .${t.iconSmall}`]:{marginLeft:2},[`& .${t.deleteIcon}`]:{marginRight:5},[`& .${t.deleteIconSmall}`]:{marginRight:3}}},...Object.entries(e.palette).filter(E()).map(([o])=>({props:{variant:"outlined",color:o},style:{color:(e.vars||e).palette[o].main,border:`1px solid ${e.alpha((e.vars||e).palette[o].main,.7)}`,[`&.${t.clickable}:hover`]:{backgroundColor:e.alpha((e.vars||e).palette[o].main,(e.vars||e).palette.action.hoverOpacity)},[`&.${t.focusVisible}`]:{backgroundColor:e.alpha((e.vars||e).palette[o].main,(e.vars||e).palette.action.focusOpacity)},[`& .${t.deleteIcon}`]:{color:e.alpha((e.vars||e).palette[o].main,.7),"&:hover, &:active":{color:(e.vars||e).palette[o].main}}}}))]}})),ze=X("span",{name:"MuiChip",slot:"Label",overridesResolver:(e,r)=>{const{ownerState:o}=e,{size:l}=o;return[r.label,r[`label${n(l)}`]]}})({overflow:"hidden",textOverflow:"ellipsis",paddingLeft:12,paddingRight:12,whiteSpace:"nowrap",variants:[{props:{variant:"outlined"},style:{paddingLeft:11,paddingRight:11}},{props:{size:"small"},style:{paddingLeft:8,paddingRight:8}},{props:{size:"small",variant:"outlined"},style:{paddingLeft:7,paddingRight:7}}]});function q(e){return e.key==="Backspace"||e.key==="Delete"}const De=p.forwardRef(function(r,o){const l=de({props:r,name:"MuiChip"}),{avatar:s,className:m,clickable:u,color:d="default",component:g,deleteIcon:x,disabled:i=!1,icon:$,label:S,onClick:b,onDelete:f,onKeyDown:w,onKeyUp:y,size:L="medium",variant:I="filled",tabIndex:k,skipFocusWhenDisabled:_=!1,slots:v={},slotProps:P={},...Y}=l,Z=p.useRef(null),ee=be(Z,o),U=c=>{c.stopPropagation(),f(c)},ae=c=>{c.currentTarget===c.target&&q(c)&&c.preventDefault(),w&&w(c)},re=c=>{c.currentTarget===c.target&&f&&q(c)&&f(c),y&&y(c)},F=u!==!1&&b?!0:u,M=F||f?A:g||"div",T={...l,component:M,disabled:i,size:L,color:d,iconColor:p.isValidElement($)&&$.props.color||d,onDelete:!!f,clickable:F,variant:I},j=Pe(T),oe=M===A?{component:g||"div",focusVisibleClassName:j.focusVisible,...f&&{disableRipple:!0}}:{};let V=null;f&&(V=x&&p.isValidElement(x)?p.cloneElement(x,{className:R(x.props.className,j.deleteIcon),onClick:U}):a.jsx(Ne,{className:j.deleteIcon,onClick:U}));let H=null;s&&p.isValidElement(s)&&(H=p.cloneElement(s,{className:R(j.avatar,s.props.className)}));let K=null;$&&p.isValidElement($)&&(K=p.cloneElement($,{className:R(j.icon,$.props.className)}));const B={slots:v,slotProps:P},[te,le]=W("root",{elementType:Re,externalForwardedProps:{...B,...Y},ownerState:T,shouldForwardComponentProp:!0,ref:ee,className:R(j.root,m),additionalProps:{disabled:F&&i?!0:void 0,tabIndex:_&&i?-1:k,...oe},getSlotProps:c=>({...c,onClick:C=>{c.onClick?.(C),b?.(C)},onKeyDown:C=>{c.onKeyDown?.(C),ae(C)},onKeyUp:C=>{c.onKeyUp?.(C),re(C)}})}),[ne,se]=W("label",{elementType:ze,externalForwardedProps:B,ownerState:T,className:j.label});return a.jsxs(te,{as:M,...le,children:[H||K,a.jsx(ne,{...se,children:S}),V]})}),Ee={neutral:"bg-surface text-muted border-border",ok:"bg-accent-soft text-accent border-accent",bad:"bg-[#fff5f5] text-danger border-danger",warn:"bg-amber-50 text-amber-700 border-amber-300"};function G({variant:e="neutral",children:r,className:o}){return a.jsx(De,{label:r,variant:"outlined",size:"small",className:`${Ee[e]} ${o||""}`})}function Le(e){const{pathname:r,search:o}=e,l=r.match(/^\/part\/(\d+)\/?$/),s=l?Number(l[1]):NaN;if(Number.isFinite(s)&&s>0)return s;const m=new URLSearchParams(o||""),u=Number(m.get("id")||"");return Number.isFinite(u)&&u>0?u:null}function O({title:e,items:r,state:o}){const l=ye(o).toString();return a.jsxs("div",{className:"rounded-md border border-border bg-surface p-4",children:[a.jsx("div",{className:"mb-2 text-sm font-medium",children:e}),r.length===0?a.jsx("p",{className:"text-sm text-muted",children:"无"}):a.jsx("div",{className:"grid gap-2",children:r.map(s=>a.jsx("a",{href:`/part.html?id=${encodeURIComponent(String(s.id))}${l?`&${l}`:""}`,className:"rounded-md border border-border bg-surface-soft px-3 py-2 font-mono text-xs transition-colors duration-fast ease-premium hover:bg-accent-soft",children:s.pn||s.part_number||"-"},s.id))})]})}function _e(){const e=Le(window.location),[r,o]=p.useState(null),[l,s]=p.useState(!0),[m,u]=p.useState(""),d=p.useMemo(()=>xe(window.location.search),[]),g=p.useMemo(()=>ve(d),[d]),x=p.useMemo(()=>$e(window.location.search,g),[g]);if(p.useEffect(()=>{if(!e){u("无效的零件 ID"),s(!1);return}(async()=>{try{const v=await je(`/api/part/${e}`);o(v)}catch(v){u(String(v?.message||v))}finally{s(!1)}})()},[e]),l)return a.jsx(z,{backHref:x,children:a.jsx(D,{children:a.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted",children:[a.jsx(N,{name:"progress_activity",size:18,className:"animate-spin"}),"加载中..."]})})});if(m)return a.jsx(z,{backHref:x,children:a.jsx(ke,{message:`加载失败：${m}`,actionLabel:"重试",onAction:()=>window.location.reload()})});const i=r?.part;if(!i)return a.jsx(z,{backHref:x,children:a.jsx(Se,{title:"未找到零件信息"})});const $=String(i.pn||i.part_number_canonical||i.part_number_cell||"-"),S=String(i.source_relative_path||i.source_pdf||i.pdf||""),b=Number(i.page||i.page_num||1),f=Number(i.page_end||b),w=String(i.nom||i.nomenclature||i.nomenclature_clean||"").trim(),y=we(w),L=he(w||"-"),I=encodeURIComponent(S),k=new URLSearchParams;k.set("pdf",S),k.set("page",String(b)),k.set("return_to",Ce(`${window.location.pathname}${window.location.search}`));const _=`/viewer.html?${k.toString()}`;return a.jsx(z,{backHref:x,children:a.jsxs("div",{className:"grid gap-4",children:[a.jsxs(D,{className:"grid gap-4",children:[a.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2",children:[a.jsxs(J,{component:"a",href:_,target:"_blank",rel:"noreferrer",variant:"primary",className:"gap-2",children:[a.jsx(N,{name:"open_in_new",size:18}),"打开页面"]}),a.jsxs(J,{component:"a",href:`/pdf/${I}#page=${b}`,target:"_blank",rel:"noreferrer",variant:"ghost",className:"gap-2",children:[a.jsx(N,{name:"description",size:18}),"原 PDF"]})]}),a.jsxs("div",{className:"border-b border-border pb-3",children:[a.jsx("div",{className:"font-mono text-[30px] font-semibold leading-tight",children:$}),a.jsxs("p",{className:"mt-1 text-sm text-muted",children:[S||"-"," · 页 ",b,f!==b?`~${f}`:""]})]}),a.jsxs("div",{className:"grid gap-3 md:grid-cols-2 xl:grid-cols-3",children:[a.jsx(h,{label:"来源",value:S||"-"}),a.jsx(h,{label:"页码",value:f!==b?`${b}~${f}`:String(b)}),a.jsx(h,{label:"图号",value:String(i.fig||i.figure_code||"-")}),a.jsx(h,{label:"项号",value:String(i.fig_item||"-")}),a.jsx(h,{label:"数量",value:String(i.units||i.units_per_assy||"-")}),a.jsx(h,{label:"适用号段",value:String(i.eff||i.effectivity||"-")})]}),a.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.jsxs(G,{variant:y.optional?"ok":"neutral",children:["optional: ",y.optional?"是":"否"]}),a.jsxs(G,{variant:y.replace?"ok":"neutral",children:["replace: ",y.replace?"是":"否"]})]}),a.jsxs("div",{className:"rounded-md border border-border bg-surface-soft p-4",children:[a.jsx("div",{className:"mb-2 text-sm font-medium",children:"术语"}),a.jsx("p",{className:"whitespace-pre-wrap break-words text-sm leading-6 text-text",children:L.map((v,P)=>v.hit?a.jsx("mark",{className:"rounded-sm bg-accent-soft px-1 text-text",children:v.text},P):a.jsx(Q.Fragment,{children:v.text},P))})]})]}),a.jsxs(D,{children:[a.jsxs("div",{className:"mb-3 flex items-center gap-2 text-sm font-medium",children:[a.jsx(N,{name:"account_tree",size:18,sx:{color:"text.secondary"}}),"层级关系"]}),a.jsxs("div",{className:"grid gap-3 md:grid-cols-2 xl:grid-cols-3",children:[a.jsx(O,{title:"父辈",items:r?.parents||[],state:d}),a.jsx(O,{title:"平辈",items:r?.siblings||[],state:d}),a.jsx(O,{title:"子辈",items:r?.children||[],state:d})]})]}),a.jsxs(D,{children:[a.jsxs("div",{className:"mb-2 flex items-center gap-2 text-sm font-medium",children:[a.jsx(N,{name:"link",size:18,sx:{color:"text.secondary"}}),"整页预览"]}),a.jsx("div",{className:"overflow-hidden rounded-md border border-border",children:a.jsx("img",{src:`/render/${I}/${b}.png`,alt:"PDF page preview",className:"block w-full bg-surface"})})]})]})})}function h({label:e,value:r}){return a.jsxs("div",{className:"rounded-md border border-border bg-surface p-3",children:[a.jsx("div",{className:"text-[10px] uppercase tracking-wider text-muted",children:e}),a.jsx("div",{className:"mt-1 font-mono text-sm font-medium text-text",children:r})]})}pe.createRoot(document.getElementById("root")).render(a.jsx(Q.StrictMode,{children:a.jsx(ue,{children:a.jsx(_e,{})})}));
