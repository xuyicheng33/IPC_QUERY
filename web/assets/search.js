import{r as l,g as L,a as J,u as G,j as t,b as Q,d as k,e as ie,M as K,c as le,R as ce,A as de}from"./chunks/AppProviders.js";import{s as O,n as R,A as pe,E as ue,c as me,f as B,b as V,a as ge}from"./chunks/urlState.js";import{B as xe,E as he}from"./chunks/ErrorState.js";import{c as X,s as Z,m as ae,C as Y,B as q}from"./chunks/Card.js";import{I as fe,S as F}from"./chunks/Select.js";const re=l.createContext();function be(e){return L("MuiTable",e)}J("MuiTable",["root","stickyHeader"]);const ye=e=>{const{classes:a,stickyHeader:o}=e;return X({root:["root",o&&"stickyHeader"]},be,a)},ve=Z("table",{name:"MuiTable",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:o}=e;return[a.root,o.stickyHeader&&a.stickyHeader]}})(ae(({theme:e})=>({display:"table",width:"100%",borderCollapse:"collapse",borderSpacing:0,"& caption":{...e.typography.body2,padding:e.spacing(2),color:(e.vars||e).palette.text.secondary,textAlign:"left",captionSide:"bottom"},variants:[{props:({ownerState:a})=>a.stickyHeader,style:{borderCollapse:"separate"}}]}))),ee="table",je=l.forwardRef(function(a,o){const c=G({props:a,name:"MuiTable"}),{className:m,component:d=ee,padding:p="normal",size:u="medium",stickyHeader:h=!1,...z}=c,g={...c,component:d,padding:p,size:u,stickyHeader:h},_=ye(g),N=l.useMemo(()=>({padding:p,size:u,stickyHeader:h}),[p,u,h]);return t.jsx(re.Provider,{value:N,children:t.jsx(ve,{as:d,role:d===ee?null:"table",ref:o,className:Q(_.root,m),ownerState:g,...z})})}),Ce=l.createContext();function Se(e){return L("MuiTableCell",e)}const _e=J("MuiTableCell",["root","head","body","footer","sizeSmall","sizeMedium","paddingCheckbox","paddingNone","alignLeft","alignCenter","alignRight","alignJustify","stickyHeader"]),Ne=e=>{const{classes:a,variant:o,align:c,padding:m,size:d,stickyHeader:p}=e,u={root:["root",o,p&&"stickyHeader",c!=="inherit"&&`align${k(c)}`,m!=="normal"&&`padding${k(m)}`,`size${k(d)}`]};return X(u,Se,a)},Te=Z("td",{name:"MuiTableCell",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:o}=e;return[a.root,a[o.variant],a[`size${k(o.size)}`],o.padding!=="normal"&&a[`padding${k(o.padding)}`],o.align!=="inherit"&&a[`align${k(o.align)}`],o.stickyHeader&&a.stickyHeader]}})(ae(({theme:e})=>({...e.typography.body2,display:"table-cell",verticalAlign:"inherit",borderBottom:e.vars?`1px solid ${e.vars.palette.TableCell.border}`:`1px solid
    ${e.palette.mode==="light"?e.lighten(e.alpha(e.palette.divider,1),.88):e.darken(e.alpha(e.palette.divider,1),.68)}`,textAlign:"left",padding:16,variants:[{props:{variant:"head"},style:{color:(e.vars||e).palette.text.primary,lineHeight:e.typography.pxToRem(24),fontWeight:e.typography.fontWeightMedium}},{props:{variant:"body"},style:{color:(e.vars||e).palette.text.primary}},{props:{variant:"footer"},style:{color:(e.vars||e).palette.text.secondary,lineHeight:e.typography.pxToRem(21),fontSize:e.typography.pxToRem(12)}},{props:{size:"small"},style:{padding:"6px 16px",[`&.${_e.paddingCheckbox}`]:{width:24,padding:"0 12px 0 16px","& > *":{padding:0}}}},{props:{padding:"checkbox"},style:{width:48,padding:"0 0 0 4px"}},{props:{padding:"none"},style:{padding:0}},{props:{align:"left"},style:{textAlign:"left"}},{props:{align:"center"},style:{textAlign:"center"}},{props:{align:"right"},style:{textAlign:"right",flexDirection:"row-reverse"}},{props:{align:"justify"},style:{textAlign:"justify"}},{props:({ownerState:a})=>a.stickyHeader,style:{position:"sticky",top:0,zIndex:2,backgroundColor:(e.vars||e).palette.background.default}}]}))),oe=l.forwardRef(function(a,o){const c=G({props:a,name:"MuiTableCell"}),{align:m="inherit",className:d,component:p,padding:u,scope:h,size:z,sortDirection:g,variant:_,...N}=c,x=l.useContext(re),T=l.useContext(Ce),j=T&&T.variant==="head";let C;p?C=p:C=j?"th":"td";let y=h;C==="td"?y=void 0:!y&&j&&(y="col");const $=_||T&&T.variant,S={...c,align:m,component:C,padding:u||(x&&x.padding?x.padding:"normal"),size:z||(x&&x.size?x.size:"medium"),sortDirection:g,stickyHeader:$==="head"&&x&&x.stickyHeader,variant:$},H=Ne(S);let A=null;return g&&(A=g==="asc"?"ascending":"descending"),t.jsx(Te,{as:C,ref:o,className:Q(H.root,d),"aria-sort":A,scope:y,ownerState:S,...N})});function Me(e){return L("MuiTableContainer",e)}J("MuiTableContainer",["root"]);const we=e=>{const{classes:a}=e;return X({root:["root"]},Me,a)},ke=Z("div",{name:"MuiTableContainer",slot:"Root"})({width:"100%",overflowX:"auto"}),ze=l.forwardRef(function(a,o){const c=G({props:a,name:"MuiTableContainer"}),{className:m,component:d="div",...p}=c,u={...c,component:d},h=we(u);return t.jsx(ke,{ref:o,as:d,className:Q(h.root,m),ownerState:u,...p})});function Pe({className:e,children:a}){return t.jsx(ze,{component:"div",className:e,sx:{borderRadius:3},children:a})}function Re({className:e,children:a}){return t.jsx(je,{size:"small",className:e,children:a})}function E({className:e,children:a}){return t.jsx(oe,{className:e,sx:{py:1.2,px:1.5,bgcolor:"action.hover",borderBottomColor:"divider",fontSize:12,fontWeight:700,letterSpacing:.4},children:a})}function U({className:e,children:a}){return t.jsx(oe,{className:ie("align-top",e),sx:{py:1.2,px:1.5,borderBottomColor:"divider"},children:a})}function te(e,a){const o=Number.parseInt(String(e??""),10);return Number.isFinite(o)&&o>0?o:Math.max(1,a)}function W(e,a){const o=Math.max(0,Number(e)||0),c=Math.max(1,Number(a)||1);return Math.max(1,Math.ceil(o/c))}function se(e,a){const o=Math.max(1,Number(e)||1),c=Math.max(1,Number(a)||1);return Math.min(o,c)}function $e(e,a,o){return Math.max(0,Number(o)||0)>0&&e!==a}const w=60;function He(){const[e,a]=l.useState(()=>O(window.location.search)),[o,c]=l.useState([]),[m,d]=l.useState([]),[p,u]=l.useState(0),[h,z]=l.useState(w),[g,_]=l.useState(!1),[N,x]=l.useState(""),[T,j]=l.useState(""),C=l.useMemo(()=>{const s=new Set([""]);for(const r of o){const i=R(r.relative_dir||"");s.add(i)}return Array.from(s.values()).sort((r,i)=>r.localeCompare(i))},[o]),y=l.useMemo(()=>{const s=e.source_dir;return o.filter(r=>{const i=R(r.relative_dir||"");return!s||i===s})},[o,e.source_dir]),$=l.useMemo(()=>{const s=new Map;for(const i of y){const n=String(i.pdf_name||i.relative_path||"").trim();n&&s.set(n,(s.get(n)||0)+1)}const r=new Set;for(const[i,n]of s.entries())n>1&&r.add(i);return r},[y]),S=l.useMemo(()=>W(p,h),[p,h]),H=s=>{const r=ge(s,w);history.replaceState({...s},"",r)},A=async()=>{const s=await B("/api/docs");c(s),a(r=>{const n=!r.source_dir||s.some(f=>R(f.relative_dir||"")===r.source_dir)?r.source_dir:"",M=s.filter(f=>{const P=R(f.relative_dir||"");return!n||P===n}),b=!r.source_pdf||M.some(f=>String(f.relative_path||f.pdf_name||"")===r.source_pdf)?r.source_pdf:"";return{...r,source_dir:n,source_pdf:b}})},D=async s=>{if(H(s),x(""),!s.q){d([]),u(0),j(""),a(s);return}_(!0),j("查询中...");try{const r=s.page;let i=V(s,w),n=await B(`/api/search?${i.toString()}`),M=Array.isArray(n.results)?n.results:[],v=Math.max(0,Number(n.total||0)),b=te(n.page_size,w),f=W(v,b);const P=se(r,f);if($e(r,P,v)){const I={...s,page:P};H(I),i=V(I,w),n=await B(`/api/search?${i.toString()}`),M=Array.isArray(n.results)?n.results:[],v=Math.max(0,Number(n.total||0)),b=te(n.page_size,w),f=W(v,b),s=I}s={...s,page:se(s.page,f)},d(M),u(v),z(b),j(`match=${n.match||s.match}`),a(s)}catch(r){d([]),u(0),x(String(r?.message||r)),j("查询失败"),a(s)}finally{_(!1)}};l.useEffect(()=>{A().then(()=>D(O(window.location.search)))},[]);const ne=async s=>{s.preventDefault(),await D({...e,q:e.q.trim(),page:1})};return t.jsx(pe,{children:t.jsxs("div",{className:"grid gap-4 min-w-0",children:[t.jsx(Y,{children:t.jsxs("form",{className:"grid gap-3",onSubmit:ne,children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(fe,{value:e.q,onChange:s=>a(r=>({...r,q:s.target.value})),className:"h-11 flex-1",placeholder:"输入件号或术语关键字","aria-label":"搜索关键字"}),t.jsx(q,{variant:"primary",className:"h-11 gap-2 px-5",type:"submit",disabled:g,startIcon:t.jsx(K,{name:"search",size:18}),children:g?"查询中":"搜索"})]}),t.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-5",children:[t.jsxs("label",{className:"grid gap-1 text-xs text-muted",children:["匹配模式",t.jsxs(F,{value:e.match,onChange:s=>a(r=>({...r,match:s.target.value})),children:[t.jsx("option",{value:"pn",children:"件号"}),t.jsx("option",{value:"term",children:"术语"}),t.jsx("option",{value:"all",children:"全部"})]})]}),t.jsxs("label",{className:"grid gap-1 text-xs text-muted",children:["来源目录",t.jsx(F,{value:e.source_dir,onChange:s=>a(r=>({...r,source_dir:R(s.target.value),source_pdf:""})),children:C.map(s=>t.jsx("option",{value:s,children:s||"全部目录"},s||"root"))})]}),t.jsxs("label",{className:"grid gap-1 text-xs text-muted",children:["来源文档",t.jsxs(F,{value:e.source_pdf,onChange:s=>a(r=>({...r,source_pdf:s.target.value.trim()})),children:[t.jsx("option",{value:"",children:"全部文档"}),y.map(s=>{const r=String(s.relative_path||s.pdf_name||""),i=String(s.pdf_name||r||"-"),n=$.has(i)&&r&&r!==i?`${i} (${r})`:i;return t.jsx("option",{value:r,children:n},r)})]})]}),t.jsxs("label",{className:"flex items-center gap-2 self-end rounded-md border border-border bg-surface px-3 py-2 text-sm text-text",children:[t.jsx("input",{type:"checkbox",checked:e.include_notes,onChange:s=>a(r=>({...r,include_notes:s.target.checked}))}),"包含备注行"]}),t.jsx("div",{className:"flex items-end justify-start xl:justify-end",children:t.jsxs(xe,{variant:"neutral",className:"h-10 items-center",children:[t.jsx(K,{name:"tune",size:16,sx:{mr:.5}}),"总计 ",p," 条"]})})]})]})}),t.jsxs(Y,{children:[t.jsxs("div",{className:"mb-3 flex items-center justify-between gap-3",children:[t.jsx("div",{className:"text-sm text-muted",children:T||"等待查询"}),t.jsxs("div",{className:"text-sm text-muted",children:["第 ",e.page," / ",S," 页"]})]}),N?t.jsx(he,{message:N}):m.length===0?t.jsx(ue,{title:e.q?"暂无结果":"请输入查询词"}):t.jsx(Pe,{children:t.jsxs(Re,{children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx(E,{children:"件号"}),t.jsx(E,{children:"来源 PDF"}),t.jsx(E,{children:"页码"}),t.jsx(E,{children:"术语摘要"})]})}),t.jsx("tbody",{children:m.map(s=>{const r=me(e).toString(),i=`/part/${encodeURIComponent(String(s.id))}${r?`?${r}`:""}`,n=String(s.part_number_canonical||s.part_number_cell||"-"),M=String(s.source_relative_path||s.source_pdf||"-"),v=String(s.page_num??"-"),b=String(s.nomenclature_preview||"");return t.jsxs("tr",{className:"cursor-pointer transition-colors duration-fast ease-premium hover:bg-surface-soft",onClick:()=>{window.location.href=i},children:[t.jsx(U,{className:"font-mono text-[13px]",children:n}),t.jsx(U,{className:"max-w-[320px] whitespace-nowrap overflow-hidden text-ellipsis",children:M}),t.jsx(U,{className:"font-mono text-[13px]",children:v}),t.jsx(U,{className:"max-w-[520px] whitespace-nowrap overflow-hidden text-ellipsis",title:b,children:b})]},s.id)})})]})}),S>1&&t.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[t.jsx(q,{variant:"ghost",disabled:e.page<=1||g,onClick:()=>{D({...e,page:Math.max(1,e.page-1)})},children:"上一页"}),t.jsx(q,{variant:"ghost",disabled:e.page>=S||g,onClick:()=>{D({...e,page:Math.min(S,e.page+1)})},children:"下一页"})]})]})]})})}le.createRoot(document.getElementById("root")).render(t.jsx(ce.StrictMode,{children:t.jsx(de,{children:t.jsx(He,{})})}));
