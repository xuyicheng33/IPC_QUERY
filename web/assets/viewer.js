import{r as n,j as e,B as g,M as u,c as P,R as k,A as $}from"./chunks/AppProviders.js";import{D as C,C as R}from"./chunks/Card.js";import{I as T,S as I}from"./chunks/Select.js";import{p as F}from"./chunks/urlState.js";function j(i,a){const s=Number.parseInt(String(i||""),10);return Number.isFinite(s)&&s>0?s:a}function w(i,a){const s=Number.parseFloat(String(i||""));return Number.isFinite(s)&&s>0?s:a}const L=[1,1.5,2,3,4];function M(){const i=n.useMemo(()=>new URLSearchParams(window.location.search||""),[]),a=String(i.get("pdf")||""),s=!!a.trim(),S=encodeURIComponent(a),d=n.useMemo(()=>F(window.location.search,"/search"),[]),[r,c]=n.useState(()=>j(i.get("page"),1)),[o,N]=n.useState(()=>w(i.get("scale"),2)),[l,m]=n.useState(s?"loading":"idle"),[v,p]=n.useState(""),[b,y]=n.useState(0);n.useEffect(()=>{const t=new URLSearchParams;a&&t.set("pdf",a),t.set("page",String(r)),o!==2&&t.set("scale",String(o)),d&&t.set("return_to",d),history.replaceState(null,"",`${window.location.pathname}?${t.toString()}`)},[d,a,r,o]),n.useEffect(()=>{if(!s){m("idle"),p("缺少 `pdf` 参数，请从零件详情页进入预览。");return}m("loading"),p(`正在加载第 ${r} 页（x${o}）...`)},[s,r,o,b]),n.useEffect(()=>{const t=x=>{if(!s)return;const f=x.target?.tagName||"";f==="INPUT"||f==="TEXTAREA"||f==="SELECT"||(x.key==="ArrowLeft"&&c(h=>Math.max(1,h-1)),x.key==="ArrowRight"&&c(h=>h+1))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[s]);const E=`/render/${S}/${r}.png?scale=${encodeURIComponent(String(o))}&t=${b}`;return e.jsx(C,{backHref:d,contentClassName:"py-6",children:e.jsxs(R,{className:"grid gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(g,{variant:"ghost",className:"gap-1.5",disabled:!s,onClick:()=>c(t=>Math.max(1,t-1)),children:[e.jsx(u,{name:"chevron_left",size:18}),"上一页"]}),e.jsx(T,{type:"number",inputProps:{min:1,step:1},className:"w-[96px]",value:r,onChange:t=>c(Math.max(1,j(t.target.value,r))),disabled:!s,"aria-label":"页码"}),e.jsxs(g,{variant:"ghost",className:"gap-1.5",disabled:!s,onClick:()=>c(t=>t+1),children:["下一页",e.jsx(u,{name:"chevron_right",size:18})]}),e.jsx(I,{className:"w-[104px]",value:String(o),onChange:t=>N(w(t.target.value,2)),disabled:!s,"aria-label":"缩放",children:L.map(t=>e.jsxs("option",{value:t,children:["x",t]},t))}),e.jsxs(g,{component:"a",href:s?`/pdf/${S}?p=${r}#page=${r}`:"#",target:"_blank",rel:"noreferrer",variant:"ghost",className:"gap-2",disabled:!s,children:[e.jsx(u,{name:"description",size:18}),"原 PDF"]})]}),s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-hidden rounded-md border border-border",children:e.jsx("img",{src:E,alt:"PDF page preview",className:"block w-full bg-surface",onLoad:()=>{m("ready"),p(`${a} · 第 ${r} 页 · x${o}`)},onError:()=>{m("error"),p("预览加载失败：可能页码超出范围，或 PDF 未找到")}})}),e.jsxs("div",{className:"flex items-center justify-between gap-3 text-sm text-muted",children:[e.jsxs("div",{className:"inline-flex items-center gap-2",children:[e.jsx(u,{name:l==="loading"?"progress_activity":l==="error"?"warning":"task_alt",size:16,className:l==="loading"?"animate-spin":""}),v||"准备完成"]}),l==="error"?e.jsx(g,{variant:"ghost",onClick:()=>y(t=>t+1),children:"重试"}):null]})]}):e.jsx("div",{className:"rounded-md border border-dashed border-border bg-surface-soft px-6 py-8 text-sm text-muted",children:"缺少 `pdf` 参数，请从零件详情页进入预览。"})]})})}P.createRoot(document.getElementById("root")).render(e.jsx(k.StrictMode,{children:e.jsx($,{children:e.jsx(M,{})})}));
