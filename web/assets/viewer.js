import{r as o,j as e,B as l,M as d,c as j,R as v,A as S}from"./chunks/AppProviders.js";import{C as N}from"./chunks/Card.js";import{I as y}from"./chunks/Input.js";import{S as P}from"./chunks/Select.js";function h(n,a){const t=Number.parseInt(String(n||""),10);return Number.isFinite(t)&&t>0?t:a}function f(n,a){const t=Number.parseFloat(String(n||""));return Number.isFinite(t)&&t>0?t:a}const $=[1,1.5,2,3,4];function k(){const n=o.useMemo(()=>new URLSearchParams(window.location.search||""),[]),a=String(n.get("pdf")||""),t=!!a.trim(),p=encodeURIComponent(a),[r,c]=o.useState(()=>h(n.get("page"),1)),[i,u]=o.useState(()=>f(n.get("scale"),2)),[w,x]=o.useState("");o.useEffect(()=>{const s=new URLSearchParams;a&&s.set("pdf",a),s.set("page",String(r)),i!==2&&s.set("scale",String(i)),history.replaceState(null,"",`${window.location.pathname}?${s.toString()}`)},[a,r,i]),o.useEffect(()=>{const s=g=>{t&&(g.key==="ArrowLeft"&&c(m=>Math.max(1,m-1)),g.key==="ArrowRight"&&c(m=>m+1))};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[t]);const b=`/render/${p}/${r}.png?scale=${encodeURIComponent(String(i))}`;return e.jsxs("div",{className:"min-h-screen bg-bg text-text",children:[e.jsx("header",{className:"sticky top-0 z-20 border-b border-border bg-surface",children:e.jsxs("div",{className:"mx-auto flex min-h-16 w-full max-w-[1360px] flex-wrap items-center justify-between gap-3 px-4 py-2 md:px-6",children:[e.jsx("div",{className:"text-sm font-medium",children:t?`页预览：${a}`:"页预览（缺少 pdf 参数）"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(l,{variant:"ghost",className:"gap-1.5",onClick:()=>{if(window.history.length>1){window.history.back();return}window.location.href="/"},children:[e.jsx(d,{name:"arrow_back",size:18}),"返回上一级"]}),e.jsxs(l,{variant:"ghost",className:"gap-1.5",disabled:!t,onClick:()=>c(s=>Math.max(1,s-1)),children:[e.jsx(d,{name:"chevron_left",size:18}),"上一页"]}),e.jsx(y,{type:"number",inputProps:{min:1,step:1},className:"w-[92px]",value:r,onChange:s=>c(Math.max(1,h(s.target.value,r))),disabled:!t,"aria-label":"页码"}),e.jsxs(l,{variant:"ghost",className:"gap-1.5",disabled:!t,onClick:()=>c(s=>s+1),children:["下一页",e.jsx(d,{name:"chevron_right",size:18})]}),e.jsx(P,{className:"w-[96px]",value:String(i),onChange:s=>u(f(s.target.value,2)),disabled:!t,"aria-label":"缩放",children:$.map(s=>e.jsxs("option",{value:s,children:["x",s]},s))}),e.jsx("a",{href:t?`/pdf/${p}?p=${r}#page=${r}`:void 0,target:"_blank",rel:"noreferrer",children:e.jsxs(l,{variant:"ghost",className:"gap-2",disabled:!t,children:[e.jsx(d,{name:"description",size:18}),"原 PDF"]})})]})]})}),e.jsx("main",{className:"mx-auto w-full max-w-[1360px] px-4 py-6 md:px-6",children:e.jsx(N,{children:t?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:b,alt:"PDF page preview",className:"w-full rounded-md border border-border bg-surface-soft",onLoad:()=>{x(`${a} · 第 ${r} 页 · x${i}`)},onError:()=>{x("预览加载失败：可能页码超出范围，或 PDF 未找到")}}),e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-xs text-muted",children:[e.jsx(d,{name:"progress_activity",size:15,className:"animate-spin"}),w||"加载中..."]})]}):e.jsx("div",{className:"rounded-md border border-dashed border-border bg-surface-soft px-6 py-8 text-sm text-muted",children:"缺少 `pdf` 参数，请从零件详情页进入预览。"})})})]})}j.createRoot(document.getElementById("root")).render(e.jsx(v.StrictMode,{children:e.jsx(S,{children:e.jsx(k,{})})}));
